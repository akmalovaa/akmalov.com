<!doctype html>
<html lang="ru" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-kubernetes/k8s-notes">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">k8s заметки | Artur Akmalov</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://akmalov.com/img/logo.svg"><meta data-rh="true" name="twitter:image" content="https://akmalov.com/img/logo.svg"><meta data-rh="true" property="og:url" content="https://akmalov.com/docs/kubernetes/k8s-notes"><meta data-rh="true" name="docusaurus_locale" content="ru"><meta data-rh="true" name="docsearch:language" content="ru"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="k8s заметки | Artur Akmalov"><meta data-rh="true" name="description" content="Мои конспекты по куберу. Описал своими словами, могут быть ошибки или неточности"><meta data-rh="true" property="og:description" content="Мои конспекты по куберу. Описал своими словами, могут быть ошибки или неточности"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://akmalov.com/docs/kubernetes/k8s-notes"><link data-rh="true" rel="alternate" href="https://akmalov.com/docs/kubernetes/k8s-notes" hreflang="ru"><link data-rh="true" rel="alternate" href="https://akmalov.com/docs/kubernetes/k8s-notes" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Artur Akmalov RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Artur Akmalov Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Artur Akmalov JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SH0K5XVKDG"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SH0K5XVKDG",{anonymize_ip:!0})</script>



<link rel="preconnect" href="https://mc.yandex.ru">
<script>!function(e,t,a,c,n,r,i){e[n]=e[n]||function(){(e[n].a=e[n].a||[]).push(arguments)},e[n].l=1*new Date,r=t.createElement(a),i=t.getElementsByTagName(a)[0],r.async=1,r.src="https://mc.yandex.ru/metrika/tag.js",i.parentNode.insertBefore(r,i)}(window,document,"script",0,"ym"),ym(91073403,"init",{defer:!0,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!1,ecommerce:!1,trackHash:!1})</script>
<noscript>
                            <div><img src="https://mc.yandex.ru/watch/91073403" style="position:absolute; left:-9999px;" alt=""></div>
                        </noscript><link rel="stylesheet" href="/assets/css/styles.10c6edd5.css">
<link rel="preload" href="/assets/js/runtime~main.45f96ea9.js" as="script">
<link rel="preload" href="/assets/js/main.b12f64e1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Перейти к основному содержимому"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Перейти к основному содержимому</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Переключить навигационную панель" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Akmalov Artur" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Akmalov Artur" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Akmalov Artur</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/about">About</a><a href="https://github.com/akmalovaa" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Прокрутка к началу" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Мои заметки</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/soft">Soft</a><button aria-label="Свернуть/развернуть категорию &#x27;Soft&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/python">Python</a><button aria-label="Свернуть/развернуть категорию &#x27;Python&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Свернуть/развернуть категорию &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubernetes/commands">commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/kubernetes/k8s-notes">k8s заметки</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubernetes/kubespray">kubespray</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/docker">Docker</a><button aria-label="Свернуть/развернуть категорию &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/helm">Helm</a><button aria-label="Свернуть/развернуть категорию &#x27;Helm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/ansible">Ansible</a><button aria-label="Свернуть/развернуть категорию &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/proxmox">Proxmox</a><button aria-label="Свернуть/развернуть категорию &#x27;Proxmox&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/cloud">Cloud</a><button aria-label="Свернуть/развернуть категорию &#x27;Cloud&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/git">Git</a><button aria-label="Свернуть/развернуть категорию &#x27;Git&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/mikrotik">Mikrotik</a><button aria-label="Свернуть/развернуть категорию &#x27;Mikrotik&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/misc">Misc</a><button aria-label="Свернуть/развернуть категорию &#x27;Misc&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/учеба">Учеба</a><button aria-label="Свернуть/развернуть категорию &#x27;Учеба&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/examples-docs">Examples docs</a><button aria-label="Свернуть/развернуть категорию &#x27;Examples docs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Навигационная цепочка текущей страницы"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Главная страница" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/kubernetes"><span itemprop="name">Kubernetes</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">k8s заметки</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Содержание этой страницы</button></div><div class="theme-doc-markdown markdown"><h1>k8s заметки</h1><p>Мои конспекты по куберу. Описал своими словами, могут быть ошибки или неточности
Ссылка на официальную документацию <a href="https://kubernetes.io/docs/home/" target="_blank" rel="noopener noreferrer">kubernetes.io</a></p><p>Ниже представлена галерея архитектуры с разных сайтов, суть одна визуализация разная
<img loading="lazy" alt="Kubernetes Architecture" src="/assets/images/components-of-kubernetes-03520ce36147308a5c9110e9ba6c4eda.png" title="Kubernetes Architecture" width="1500" height="685" class="img_ev3q">
<img loading="lazy" alt="Kubernetes Architecture" src="/assets/images/k8s-arch2-db24b2444f238fbc2e38077bdb934278.png" title="Kubernetes Architecture" width="800" height="478" class="img_ev3q">
<img loading="lazy" alt="Kubernetes Architecture" src="/assets/images/k8s-arch3-a2878a7ae1c1fb6d0bf490d8cf5efde1.png" title="Kubernetes Architecture" width="760" height="520" class="img_ev3q">
<img loading="lazy" alt="Kubernetes Architecture" src="/assets/images/Kubernetes-components-679a3e8f44718a0ea9331914990be4f9.png" title="Kubernetes Architecture" width="1154" height="774" class="img_ev3q">
<img loading="lazy" alt="Kubernetes Architecture" src="/assets/images/maxresdefault-aef836d3188220d601d903466b29aa8d.jpg" title="Kubernetes Architecture" width="1019" height="565" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="компоненты-мастера-master-node">Компоненты мастера (master node)<a href="#компоненты-мастера-master-node" class="hash-link" aria-label="Прямая ссылка на Компоненты мастера (master node)" title="Прямая ссылка на Компоненты мастера (master node)">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-server-kube-scheduler">API Server (kube-scheduler)<a href="#api-server-kube-scheduler" class="hash-link" aria-label="Прямая ссылка на API Server (kube-scheduler)" title="Прямая ссылка на API Server (kube-scheduler)">​</a></h3><p>Основная шина взаимодействия и точка входа для всех запросов. Аутентификация, валидация (линтер)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scheduler-kube-scheduler">Scheduler (kube-scheduler)<a href="#scheduler-kube-scheduler" class="hash-link" aria-label="Прямая ссылка на Scheduler (kube-scheduler)" title="Прямая ссылка на Scheduler (kube-scheduler)">​</a></h3><p>Определяет на какой worker ноде создать новый под, в зависимости от требуемых ресурсов и занятости нод. Смотрит и проверяет нагрузку на ноды, по оределенной логике определяет куда назначить под</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="controller-kube-controller-manager">Controller (kube controller manager)<a href="#controller-kube-controller-manager" class="hash-link" aria-label="Прямая ссылка на Controller (kube controller manager)" title="Прямая ссылка на Controller (kube controller manager)">​</a></h3><p>Проверяет состояние кластера по API (через kube-api) в etcd. Демон который включается в себя группы контроллеров. Занимается созданием и обслуживанием linux name-space.</p><p>Контролируют разные ячейки типо deployment, replicaset, pod. Например если удалить под, а вышего него есть replicsate, deployment с желаемым состоянием под удалится, controller manager видит желаемое состояние ячеек и поднимет новый под.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="etcd">Etcd<a href="#etcd" class="hash-link" aria-label="Прямая ссылка на Etcd" title="Прямая ссылка на Etcd">​</a></h3><p>База данных (хранилище ключ-значение). Хранятся все манифесты, текущее состояние, желаемое состояние. Любая сущность описанная в yml. Для работы необходим кворум (нечетное количество). Один master — один etcd, поэтому для отказоустойчивости желательно иметь 3 мастер ноды. В некоторых случаях выносят за пределы мастера в отдельный кластер БД.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="компоненты-ноды-node-worker-node">Компоненты ноды Node (worker node)<a href="#компоненты-ноды-node-worker-node" class="hash-link" aria-label="Прямая ссылка на Компоненты ноды Node (worker node)" title="Прямая ссылка на Компоненты ноды Node (worker node)">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pod">Pod<a href="#pod" class="hash-link" aria-label="Прямая ссылка на Pod" title="Прямая ссылка на Pod">​</a></h3><p>Базовая сущность k8s, которая группирует контейнеры между собой. Внутри может содержать несколько контейнеров ( контейнеры находятся в одном namespace шарят между собой loopback интерфейс)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kubelet">Kubelet<a href="#kubelet" class="hash-link" aria-label="Прямая ссылка на Kubelet" title="Прямая ссылка на Kubelet">​</a></h3><p>Бинарник, основной компонент k8s существует на каждой worker ноде кластера. Проверят API сервер на предмет описания новых подов, смотрим принес ли controller что нибудь новое, если есть изменения пытается применить их. Например смотрит на новые ноды которые должны быть развернуты на своей ноде. (который назначает scheduler (положил в etcd))</p><p>После того как привел к нужному состоянию передает информацию в API сервер. Также сообщает постоянно о состояних подов</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kube-proxy">Kube-proxy<a href="#kube-proxy" class="hash-link" aria-label="Прямая ссылка на Kube-proxy" title="Прямая ссылка на Kube-proxy">​</a></h3><p>Представляет собой контейнер, аналог ривер прокси, отвечает за пересылку и проксирование запросов к уже существующим сервисам или приложениям, в приватной сети самого кубера, по умолчанию использует ipvs (аналог iptables оптимизированный для k8s).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optionals-addons">Optionals Addons<a href="#optionals-addons" class="hash-link" aria-label="Прямая ссылка на Optionals Addons" title="Прямая ссылка на Optionals Addons">​</a></h3><p>Дополнительные плагины такие как RBAC, kalico (CNI),  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="сущности">Сущности<a href="#сущности" class="hash-link" aria-label="Прямая ссылка на Сущности" title="Прямая ссылка на Сущности">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment---replicaset---pod">Deployment -&gt; Replicaset -&gt; Pod<a href="#deployment---replicaset---pod" class="hash-link" aria-label="Прямая ссылка на Deployment -&gt; Replicaset -&gt; Pod" title="Прямая ссылка на Deployment -&gt; Replicaset -&gt; Pod">​</a></h3><p>Поле kind — сущности представлены и описаны в виде yaml файлов. Записываем то состояние к которму k8s должен привести. (Мы не описываем как наливать чай, а просто говорим какую кружку, какой чай, какого цвета, какой температуры и т.д. нужен как в ansible)</p><p>В yaml файл записывают минимальный необходимый набор описаний, остальное докидывает controller</p><p>Deployment — набор сценариев который порождает другую сущность replicaset ( а он своб очередь другую сущность pod)</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> nginxdemos/hello</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">0.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">livenessProbe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">readinessProbe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0.5&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 128Mi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0.5&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 128Mi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="service">Service<a href="#service" class="hash-link" aria-label="Прямая ссылка на Service" title="Прямая ссылка на Service">​</a></h3><p>Используется для доступа к подам.</p><p>В моем понимании ClusterIP сервис работает как виртуальный IP для доступа к подам и проброса портов внутри кластера, т.к. к IP адресам подов нет смысла подвязываться
А тут имеем статичный сервис который по лейблам сам направит на нужный под.
Так же там по умолчанию выполняется балансировка нагрузки по round-robin</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">service</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">cluster</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">ip</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">service</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">nodeport</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> NodePort</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">nodePort</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">30000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="пробы-probes">Пробы (Probes)<a href="#пробы-probes" class="hash-link" aria-label="Прямая ссылка на Пробы (Probes)" title="Прямая ссылка на Пробы (Probes)">​</a></h2><p>Нужны для проверки работоспособности контейнера. Проверкой проб занимается kubelet. Интересная статья про пробы хабр</p><p>Их существует три вида:</p><ul><li>Startup</li><li>Liveness</li><li>Readiness</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="startup-probe">Startup probe<a href="#startup-probe" class="hash-link" aria-label="Прямая ссылка на Startup probe" title="Прямая ссылка на Startup probe">​</a></h3><p>Производит проверку при старте контейнера, если контейнер запустился без ошибок и его процесс по PID живой значит проверка прошла успешно</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="liveness-probe">Liveness probe<a href="#liveness-probe" class="hash-link" aria-label="Прямая ссылка на Liveness probe" title="Прямая ссылка на Liveness probe">​</a></h3><p>Выполняется постоянно</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="readiness-probe">Readiness probe<a href="#readiness-probe" class="hash-link" aria-label="Прямая ссылка на Readiness probe" title="Прямая ссылка на Readiness probe">​</a></h3><p>Производит проверку при старте контейнера, если контейнер запустился без ошибок и его процесс по PID живой значит проверка прошла успешно</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="дополнительно-про-пробы">Дополнительно про пробы<a href="#дополнительно-про-пробы" class="hash-link" aria-label="Прямая ссылка на Дополнительно про пробы" title="Прямая ссылка на Дополнительно про пробы">​</a></h3><p>Производит проверку при старте контейнера, если контейнер запустился без ошибок и его процесс по PID живой значит проверка прошла успешно</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="пример-запроса-в-api-сервер">Пример запроса в API сервер<a href="#пример-запроса-в-api-сервер" class="hash-link" aria-label="Прямая ссылка на Пример запроса в API сервер" title="Прямая ссылка на Пример запроса в API сервер">​</a></h2><p>kubectl если отправляем какой нибудь манифест на создание пода например:</p><p>kubectl applay -f test.yml -n name-space
Запрос проходит аутентификацию, валидацию и передает информацию в etcd.</p><p>Scheduler через API сервер смотрит изменения etcd, видит что пытаются создать новый под, определяет ноду куда можно его засунуть и отправляет эту информацию в API сервер, а API сервер записывает в etcd</p><p>Controller manager в это время контролирует все это добро. Сморит тип kind создает ячейки внутри etcd</p><p>Дальше kubelet на соответствующей ноде видит информацию в etcd, что на него хотят загрузить под и пытается это сделать через CRI и результаты и сам процесс через API сервер сообщает в etcd.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/akmalovaa/akmalov.com/tree/main/docs/kubernetes/k8s-notes.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Отредактировать эту страницу</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Страница документа"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/kubernetes/commands"><div class="pagination-nav__sublabel">Предыдущая страница</div><div class="pagination-nav__label">commands</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/kubernetes/kubespray"><div class="pagination-nav__sublabel">Следующая страница</div><div class="pagination-nav__label">kubespray</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#компоненты-мастера-master-node" class="table-of-contents__link toc-highlight">Компоненты мастера (master node)</a><ul><li><a href="#api-server-kube-scheduler" class="table-of-contents__link toc-highlight">API Server (kube-scheduler)</a></li><li><a href="#scheduler-kube-scheduler" class="table-of-contents__link toc-highlight">Scheduler (kube-scheduler)</a></li><li><a href="#controller-kube-controller-manager" class="table-of-contents__link toc-highlight">Controller (kube controller manager)</a></li><li><a href="#etcd" class="table-of-contents__link toc-highlight">Etcd</a></li></ul></li><li><a href="#компоненты-ноды-node-worker-node" class="table-of-contents__link toc-highlight">Компоненты ноды Node (worker node)</a><ul><li><a href="#pod" class="table-of-contents__link toc-highlight">Pod</a></li><li><a href="#kubelet" class="table-of-contents__link toc-highlight">Kubelet</a></li><li><a href="#kube-proxy" class="table-of-contents__link toc-highlight">Kube-proxy</a></li><li><a href="#optionals-addons" class="table-of-contents__link toc-highlight">Optionals Addons</a></li></ul></li><li><a href="#сущности" class="table-of-contents__link toc-highlight">Сущности</a><ul><li><a href="#deployment---replicaset---pod" class="table-of-contents__link toc-highlight">Deployment -&gt; Replicaset -&gt; Pod</a></li><li><a href="#service" class="table-of-contents__link toc-highlight">Service</a></li></ul></li><li><a href="#пробы-probes" class="table-of-contents__link toc-highlight">Пробы (Probes)</a><ul><li><a href="#startup-probe" class="table-of-contents__link toc-highlight">Startup probe</a></li><li><a href="#liveness-probe" class="table-of-contents__link toc-highlight">Liveness probe</a></li><li><a href="#readiness-probe" class="table-of-contents__link toc-highlight">Readiness probe</a></li><li><a href="#дополнительно-про-пробы" class="table-of-contents__link toc-highlight">Дополнительно про пробы</a></li></ul></li><li><a href="#пример-запроса-в-api-сервер" class="table-of-contents__link toc-highlight">Пример запроса в API сервер</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Akmalov Artur</div></div></div></footer></div>
<script src="/assets/js/runtime~main.45f96ea9.js"></script>
<script src="/assets/js/main.b12f64e1.js"></script>
</body>
</html>