<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://akmalov.com/blog</id>
    <title>Artur Akmalov Blog</title>
    <updated>2024-05-12T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://akmalov.com/blog"/>
    <subtitle>Artur Akmalov Blog</subtitle>
    <icon>https://akmalov.com/img/favicon.ico</icon>
    <rights>Copyright © 2024 Facebook, Inc.</rights>
    <entry>
        <title type="html"><![CDATA[Mikrotik CHR cloud hosted router]]></title>
        <id>https://akmalov.com/blog/mikrotik-chr</id>
        <link href="https://akmalov.com/blog/mikrotik-chr"/>
        <updated>2024-05-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Mikrotik CHR Cloud Hosted Router install timeweb VPS]]></summary>
        <content type="html"><![CDATA[<p>Установка Mikrotik Cloud Hosted Router на облачный сервер и для чего я его использую</p>
<p><a href="https://akmalov.com/blog/mikrotik-chr"><img decoding="async" loading="lazy" alt="mikrotik chr" src="https://akmalov.com/assets/images/logo-bca9c52c8617b3e673896b5bec7fcc75.png" width="1500" height="500" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="введение">Введение<a href="https://akmalov.com/blog/mikrotik-chr#%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5" class="hash-link" aria-label="Прямая ссылка на Введение" title="Прямая ссылка на Введение">​</a></h2>
<p>MikroTik Cloud Hosted Router (CHR) — специальная версия RouterOS, для работы в качестве виртуальной машины. Поддерживает архитектуру x86-64-разрядную и может использоваться на большинстве популярных гипервизоров, таких как VMware, Hyper-V, VirtualBox, KVM и т.д.</p>
<p>Системные требования CHR:</p>
<ul>
<li><strong>CPU:</strong> 64-bit with virtualization support</li>
<li><strong>RAM:</strong> &gt; 256MB</li>
<li><strong>Disk:</strong> &gt; 128MB (Max: 16GB)</li>
</ul>
<p>По умолчанию в CHR включены все функции RouterOS, но немного отличается модель лицензирования. Ограничения лицензии это скорость интерфейса наружу - 1 Мбит в бесплатной версии.</p>
<p><strong>Лицензии</strong></p>
<table><thead><tr><th>Название</th><th>Скорость</th><th>Цена</th></tr></thead><tbody><tr><td>Free</td><td>1 Mbit</td><td>Бесплатно</td></tr><tr><td>P1</td><td>1 Gbit</td><td>$45</td></tr><tr><td>P10</td><td>10 Gbit</td><td>$95</td></tr></tbody></table>
<p>Управлять лицензиями можно в личном кабинете на официальном сайте mikrotik.com</p>
<p>На Avito или специализированных группах telegram можно найти от 1000 рублей за P1</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="для-чего-использую-mikrotik-chr-в-облаке">Для чего использую Mikrotik CHR в облаке<a href="https://akmalov.com/blog/mikrotik-chr#%D0%B4%D0%BB%D1%8F-%D1%87%D0%B5%D0%B3%D0%BE-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D1%8E-mikrotik-chr-%D0%B2-%D0%BE%D0%B1%D0%BB%D0%B0%D0%BA%D0%B5" class="hash-link" aria-label="Прямая ссылка на Для чего использую Mikrotik CHR в облаке" title="Прямая ссылка на Для чего использую Mikrotik CHR в облаке">​</a></h2>
<p>Как внешний узел для распределения трафика</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="стандартная-схема">Стандартная схема<a href="https://akmalov.com/blog/mikrotik-chr#%D1%81%D1%82%D0%B0%D0%BD%D0%B4%D0%B0%D1%80%D1%82%D0%BD%D0%B0%D1%8F-%D1%81%D1%85%D0%B5%D0%BC%D0%B0" class="hash-link" aria-label="Прямая ссылка на Стандартная схема" title="Прямая ссылка на Стандартная схема">​</a></h3>
<p>Интернет + статичный белый IP адрес от провайдера приходит сразу на роутер, все в дом, а дальше трафик распределяется внутри</p>
<p><a href="https://akmalov.com/assets/files/scheme1.excalidraw-a2a49e7c5d5561fc25bf53a38b1319fd.png" target="_blank"><img decoding="async" loading="lazy" alt="scheme1" src="https://akmalov.com/assets/images/scheme1.excalidraw-a2a49e7c5d5561fc25bf53a38b1319fd.png" width="1600" height="1000" class="img_ev3q"></a></p>
<p><strong>Плюсы:</strong></p>
<ul>
<li>Нет никаких зависимых сервисов, провайдер направляет весь трафик напрямую на мое устройство</li>
</ul>
<p><strong>Минусы:</strong></p>
<ul>
<li>Цена 250 рублей в месяц за белый IP адрес</li>
<li>В случаи проблем со стороны провайдера, я завязан на выданный IP адрес и резервные интернет каналы не спасут от недоступности сервисов</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="схема-c-использованием-cloud-hosted-router">Схема c использованием Cloud Hosted Router<a href="https://akmalov.com/blog/mikrotik-chr#%D1%81%D1%85%D0%B5%D0%BC%D0%B0-c-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC-cloud-hosted-router" class="hash-link" aria-label="Прямая ссылка на Схема c использованием Cloud Hosted Router" title="Прямая ссылка на Схема c использованием Cloud Hosted Router">​</a></h3>
<p>Поднять RouterOS на облачном сервере, настроить VPN + IPsec сервер</p>
<p>Настроить подключение к домашней сети и распределение трафика</p>
<p><a href="https://akmalov.com/assets/files/scheme_chr.excalidraw-65ca3a4fb33149d829de7a65a5938320.png" target="_blank"><img decoding="async" loading="lazy" alt="scheme_chr" src="https://akmalov.com/assets/images/scheme_chr.excalidraw-65ca3a4fb33149d829de7a65a5938320.png" width="1720" height="1000" class="img_ev3q"></a></p>
<p><strong>Плюсы:</strong></p>
<ul>
<li>Цена VPS + статичный белый IP, дешевле чем просто IP адрес у моего провайдера, на timeweb сервер с <code>1 CPU, 1Gb RAM, 15GB NVMe</code> (таких ресурсов для роутера хватит с большим запасом) вышло 177 ₽/мес</li>
<li>Можно спокойно менять провайдера, поднимать резервные каналы связи</li>
<li>Еще одна ступень защиты (при грамотной настройке Firewall)</li>
<li>Остаются свободные ресурсы на сервере, можно еще что-то полезное поднять</li>
</ul>
<p><strong>Минусы:</strong></p>
<ul>
<li>Появляется еще одна сетевая точка отказа</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="схема-c-использованием-cloudflare-tunnel">Схема c использованием Cloudflare tunnel<a href="https://akmalov.com/blog/mikrotik-chr#%D1%81%D1%85%D0%B5%D0%BC%D0%B0-c-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC-cloudflare-tunnel" class="hash-link" aria-label="Прямая ссылка на Схема c использованием Cloudflare tunnel" title="Прямая ссылка на Схема c использованием Cloudflare tunnel">​</a></h3>
<p>Еще один вариант, DNS провайдер Cloudflare предоставляет возможность вообще не использовать белые IP адреса</p>
<p>Если доменное имя привязано к Cloudflare, можно использовать <code>Cloudflare Zero Trust</code> и внутри своего контура поднять сервис(службу) который будет поддерживать зашифрованный тунель с Cloudflare и перенаправлять домены на нужные адреса, берет на себя даже роль прокси сервера.</p>
<p><a href="https://akmalov.com/assets/files/scheme_cloudflare.excalidraw-869415cce781417750813dfcaa47c34e.png" target="_blank"><img decoding="async" loading="lazy" alt="scheme_cloudflare" src="https://akmalov.com/assets/images/scheme_cloudflare.excalidraw-869415cce781417750813dfcaa47c34e.png" width="1780" height="1000" class="img_ev3q"></a></p>
<p>Плюсы:</p>
<ul>
<li>Полностью бесплатна</li>
<li>Дополнительная защита от DDoS</li>
<li>Можно не использовать свой proxy сервер (для простых проектов)</li>
<li>Отсутствие привязки к IP адресам</li>
<li>Автоматическое использование SSL сертификата</li>
</ul>
<p>Минусы:</p>
<ul>
<li>Поднимать в своем контуре непонятный сервис и весь трафик гонять через него</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="установка-mikrotik-chr-в-облаке">Установка MikroTik CHR в облаке<a href="https://akmalov.com/blog/mikrotik-chr#%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-mikrotik-chr-%D0%B2-%D0%BE%D0%B1%D0%BB%D0%B0%D0%BA%D0%B5" class="hash-link" aria-label="Прямая ссылка на Установка MikroTik CHR в облаке" title="Прямая ссылка на Установка MikroTik CHR в облаке">​</a></h2>
<p>В качестве примера буду использовать облака от <a href="https://timeweb.cloud/r/cp14436" target="_blank" rel="noopener noreferrer">timeweb</a></p>
<p>Создаю сервер <strong>Ubuntu</strong> и минимальными ресурсами</p>
<p><a href="https://akmalov.com/assets/files/chr_cloud_create-6b936a4391b81adb8f51e83d84f0730f.png" target="_blank"><img decoding="async" loading="lazy" alt="chr_cloud_create" src="https://akmalov.com/assets/images/chr_cloud_create-6b936a4391b81adb8f51e83d84f0730f.png" width="955" height="571" class="img_ev3q"></a></p>
<p>На созданном сервере поменять режим загрузки ОС для того, чтобы полностью остановить запись на диск <code>/dev/vda</code></p>
<p><a href="https://akmalov.com/assets/files/chr_cloud_create2-9ae00b9eaf9d1ae282b531f98d710c3a.png" target="_blank"><img decoding="async" loading="lazy" alt="chr_cloud_create2" src="https://akmalov.com/assets/images/chr_cloud_create2-9ae00b9eaf9d1ae282b531f98d710c3a.png" width="980" height="555" class="img_ev3q"></a></p>
<p><strong>Режим загрузки ОС</strong></p>
<p><strong>Выбрать тип:</strong> Загрузка с диска восстановления</p>
<p>Консоль SystemRescue (<strong>Ctrl + V</strong> работает)</p>
<p><a href="https://akmalov.com/assets/files/chr_install-ad3d75316f22068174a6dfe2a12e78f5.png" target="_blank"><img decoding="async" loading="lazy" alt="chr_install" src="https://akmalov.com/assets/images/chr_install-ad3d75316f22068174a6dfe2a12e78f5.png" width="978" height="433" class="img_ev3q"></a></p>
<p>На официальном сайте <a href="https://mikrotik.com/download" target="_blank" rel="noopener noreferrer">Mikrotik Software</a></p>
<p>Найти последнюю стабильную версию Cloud Hosted Router - <code>Raw disk image</code> и скопировать ссылку, вставить в терминале сервера восстановления (wget для скачивания образа)</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">wget</span><span class="token plain"> https://download.mikrotik.com/routeros/7.14.3/chr-7.14.3.img.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Разархивировать образ:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">unzip</span><span class="token plain"> chr-7.14.3.img.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Записать на диск <code>/dev/vda</code>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">dd</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">if</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">chr-7.14.3.img </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">of</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/dev/vda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Вернуть серверу стандартный режим загрузки и перезагрузить.</p>
<p>Для проверки подключиться с терминала или c winbox, пользователь <code>admin</code> пароль пустой.</p>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Важно</div><div class="admonitionContent_BuS1"><p>Нужно сразу сменить пароль, иначе быстро придут боты, сами поменяют и настроят</p></div></div>
<p><a href="https://akmalov.com/assets/files/chr_winbox-bca1c7362ea379be5e0586570667f32b.png" target="_blank"><img decoding="async" loading="lazy" alt="chr_winbox" src="https://akmalov.com/assets/images/chr_winbox-bca1c7362ea379be5e0586570667f32b.png" width="964" height="558" class="img_ev3q"></a></p>
<blockquote>
<p>Логи: что будет если медлить с паролем или установить простой</p>
</blockquote>
<p>Быстро подберут пароль, добавят своего пользователя, включат все сервисы для подключения, admin-скую сместят в правах и добавят данное устройства в сеть автоботов для восстания машин</p>
<p><a href="https://akmalov.com/assets/files/chr_hacked-bc874a5a54bfbc7b5abd52ca78183a6e.png" target="_blank"><img decoding="async" loading="lazy" alt="chr_hacked" src="https://akmalov.com/assets/images/chr_hacked-bc874a5a54bfbc7b5abd52ca78183a6e.png" width="1099" height="567" class="img_ev3q"></a></p>
<p>Идет постоянное сканирование портов: <code>22,23,8291,8022,8728,8729</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="настройка-chr">Настройка CHR<a href="https://akmalov.com/blog/mikrotik-chr#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-chr" class="hash-link" aria-label="Прямая ссылка на Настройка CHR" title="Прямая ссылка на Настройка CHR">​</a></h2>
<p>Первым делом базовые настройки безопасности</p>
<p>Чек лист:</p>
<ul>
<li>Создать нового пользователя с полными правами, <code>admin</code> отключить | удалить</li>
<li>Отключить лишние сервисы и поменять стандартные порты</li>
<li>Настроить Firewall</li>
<li>Отключить mac-telnet, neighbors</li>
<li>Настроить Firewall IPv6 если нужно, иначе просто отключить IPv6</li>
<li>Опционально: <em>Port Knocking</em></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vpn">VPN<a href="https://akmalov.com/blog/mikrotik-chr#vpn" class="hash-link" aria-label="Прямая ссылка на VPN" title="Прямая ссылка на VPN">​</a></h3>
<p>Этот облачный роутер настрою как центральный хаб, через который будет осуществляться подключение к домашней сети с различных устройств и внешний доступ к моим сервисам по https</p>
<p>Для подключения будет использоваться связка IPSec/L2TP. Настройки подробно описывать не буду, есть уже много готовых инструкций.</p>
<p>Когда <strong>Reverse Proxy Server</strong> находится в домашней сети, предстоит повозиться с машрутами т.к. по умолчанию обратные машруты <strong>nginx</strong> попытаются пойти через домашний маршрут в интернет</p>
<p><a href="https://akmalov.com/assets/files/chr.excalidraw-1c393ce95540131e6f6e341acce7774d.png" target="_blank"><img decoding="async" loading="lazy" alt="chr" src="https://akmalov.com/assets/images/chr.excalidraw-1c393ce95540131e6f6e341acce7774d.png" width="1760" height="860" class="img_ev3q"></a></p>
<p>Добавляю дополнительную таблицу маршрутизации <code>chr</code> на домашнем роутере</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/ip route</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> dst-address</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token plain">.0.0/0 </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">gateway</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">l2tp routing-table</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">chr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>маркировка коннектов и трафика</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">action</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">mark-connection </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">chain</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">prerouting in-interface</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">l2tp new-connection-mark</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">chr-conn </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">passthrough</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">yes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">action</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">mark-routing </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">chain</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">prerouting connection-mark</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">chr-conn new-routing-mark</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">chr-route </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">passthrough</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">yes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Если трафик пришел через l2tp туннель, помечаем соединение его как <code>chr-conn</code></li>
<li>Если видим помеченное соединение <code>chr-conn</code>, то добавляем маркировку трафика <code>chr-route</code></li>
</ul>
<p>Добавляю правило для <code>chr-route</code>, поменять таблицу маршрутизации на <code>chr</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/routing rule</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">add action=lookup-only-in-table disabled=no routing-mark=chr-route table=chr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Как вариант можно поднять <strong>Reverse Proxy</strong> <a href="https://akmalov.com/blog/mikrotik-nginx" target="_blank" rel="noopener noreferrer">Nginx на самом Mikrotik CHR </a>. Ресурсы на VPS позволяют это спокойно сделать.</p>
<p>Данный способ выглядит еще интереснее и не нужно будет с маршрутами возится.</p>
<p>В целом все.</p>
<p>Пытался показать для чего я использую RouterOS CHR и как просто развернуть его в облаке.</p>]]></content>
        <category label="homelab" term="homelab"/>
        <category label="networks" term="networks"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Mikrotik nginx reverse proxy]]></title>
        <id>https://akmalov.com/blog/mikrotik-nginx</id>
        <link href="https://akmalov.com/blog/mikrotik-nginx"/>
        <updated>2023-11-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Mikrotik container nginx reverse proxy RouterOS container]]></summary>
        <content type="html"><![CDATA[<p>Mikrotik запустить NGINX Reverse Proxy как контейнер в роутере</p>
<p><a href="https://akmalov.com/blog/mikrotik-nginx"><img decoding="async" loading="lazy" alt="mikrotik nginx container" src="https://akmalov.com/assets/images/logo-469e9f6a2bf984c4ebe66a38708cc51f.png" width="1500" height="500" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="введение">Введение<a href="https://akmalov.com/blog/mikrotik-nginx#%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5" class="hash-link" aria-label="Прямая ссылка на Введение" title="Прямая ссылка на Введение">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="о-контейнерах-в-router-os">О контейнерах в Router OS<a href="https://akmalov.com/blog/mikrotik-nginx#%D0%BE-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0%D1%85-%D0%B2-router-os" class="hash-link" aria-label="Прямая ссылка на О контейнерах в Router OS" title="Прямая ссылка на О контейнерах в Router OS">​</a></h2>
<p>Начиная с RouterOS v7.4 и выше, в mikrotik подвезли такую штуку как <strong>Container</strong>, работает на устройствах <strong>arm, arm64, x86</strong></p>
<p>Страница с описанием и примерами настроек на wiki <a href="https://help.mikrotik.com/docs/display/ROS/Container" target="_blank" rel="noopener noreferrer">help.mikrotik.com</a></p>
<p>Мне очень нравятся контейнеры, люблю Docker и с такой фичей возможности домашнего роутера теперь ограничиваются только фантазией и ресурсами</p>
<p>Про ресурсы, для тестов имеется устройство Mikrotik hap ax3 (C53UiG+5HPaxD2HPaxD) <a href="https://mikrotik.com/product/hap_ax3" target="_blank" rel="noopener noreferrer">спецификация</a>:</p>
<ul>
<li><strong>Architecture:</strong>	ARM 64bit</li>
<li><strong>CPU:</strong> IPQ-6010, 4 core, (864 - 1800) MHz</li>
<li><strong>Size of RAM:</strong> 1 GB</li>
<li><strong>Storage size:</strong>	128 MB</li>
</ul>
<p>В целом 1Gb (из них свободно примерно 650Mb) не так и много на сегодня, что же можно там поднять? На сайте wiki разработчики показывают примеры с</p>
<ul>
<li>PiHole (DNS Server с возможностями блокировки рекламы) мне больше нравится его аналог AdguardHome</li>
<li>freeradius server - не знаю, насколько актуален сегодня radius server</li>
<li>mosquitto MQTT - Message Queuing Telemetry Transport (MQTT) Protocol. Для интернета вещей</li>
<li>ThingsBoard MQTT/HTTP server - еще одна платформа для интернета вещей</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Совет с официального сайта</div><div class="admonitionContent_BuS1"><p>Внедрение функции контейнера в RouterOS позволило запускать серверы для выполнения всевозможных задач внутри маршрутизатора. Это особенно актуально для людей, которые хотят уменьшить количество устройств в своей сети.
Вместо того, чтобы запускать сервер на отдельном устройстве/машине, почему бы не запустить его внутри маршрутизатора?
<a href="https://akmalov.com/assets/files/farcry-b667744f56ae59422879505ce5abb81e.png" target="_blank"><img decoding="async" loading="lazy" alt="farcry" src="https://akmalov.com/assets/images/farcry-b667744f56ae59422879505ce5abb81e.png" width="1440" height="900" class="img_ev3q"></a></p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="routeros-nginx-reverse-proxy">RouterOS nginx reverse proxy<a href="https://akmalov.com/blog/mikrotik-nginx#routeros-nginx-reverse-proxy" class="hash-link" aria-label="Прямая ссылка на RouterOS nginx reverse proxy" title="Прямая ссылка на RouterOS nginx reverse proxy">​</a></h2>
<p>На данный момент в качестве прокси сервера стоит отдельная виртуальная машина, на котором пробовал различные инструменты (nginx, traefik, caddy)</p>
<p>Попробую перенести и запустить это внутри маршрутизатора, выбрал <strong>nginx</strong> т.к. по ресурсам RAM, он потребляем меньше всего</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="подготовка">Подготовка<a href="https://akmalov.com/blog/mikrotik-nginx#%D0%BF%EF%BF%BD%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0" class="hash-link" aria-label="Прямая ссылка на Подготовка" title="Прямая ссылка на Подготовка">​</a></h3>
<p>Функция <strong>container</strong> по умолчанию отключена, нужен физический доступ к маршрутизатору для включения</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Disclaimer</div><div class="admonitionContent_BuS1"><ul>
<li>Запуск образа контейнера на вашем маршрутизаторе может открыть брешь в системе безопасности</li>
<li>Если маршрутизатор взломан, контейнеры могут быть использованы для простой установки вредоносного программного обеспечения на ваш маршрутизатор и по сети</li>
</ul></div></div>
<p>Разработчики настаивают на использовании внешненго накопителя (usb, ssd), чтобы не насиловать файловую систему самого роутера. Установил туда небольшого размера флешку на 32Gb</p>
<p><a href="https://akmalov.com/assets/files/mikrotik-usb-af1bf381a7e61ad2f2f9e498edf730df.jpg" target="_blank"><img decoding="async" loading="lazy" alt="mikrotik-usb" src="https://akmalov.com/assets/images/mikrotik-usb-af1bf381a7e61ad2f2f9e498edf730df.jpg" width="1200" height="595" class="img_ev3q"></a></p>
<p>Имеется поддержка USB 3.0</p>
<p><a href="https://akmalov.com/assets/files/mikrotik-usb-disk-1fba13d2e18c6927ffc0e71ac9dc181d.png" target="_blank"><img decoding="async" loading="lazy" alt="mikrotik-usb-disk" src="https://akmalov.com/assets/images/mikrotik-usb-disk-1fba13d2e18c6927ffc0e71ac9dc181d.png" width="822" height="495" class="img_ev3q"></a></p>
<p><strong>RouterOS</strong></p>
<ol>
<li>
<p>Необходимо скачать <a href="https://mikrotik.com/download" target="_blank" rel="noopener noreferrer"><strong>Extra packages</strong> с официального сайта</a> выбрав нужную архитектуру
В архиве несколько разных расширений, пример названия - <code>container-7.xx.x-arm64.npk</code>. Установить и перезагрузить</p>
</li>
<li>
<p>В терминале выполнить команду для включения функции <strong>Container</strong></p>
</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/system/device-mode/update container=yes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>После этого в терминале напишет сообщение, что нужно подтвердить нажатием кнопки сброса или перезагрузкой по питанию</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="запуск-nginx-container">Запуск nginx container<a href="https://akmalov.com/blog/mikrotik-nginx#%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA-nginx-container" class="hash-link" aria-label="Прямая ссылка на Запуск nginx container" title="Прямая ссылка на Запуск nginx container">​</a></h3>
<p>Добавить виртуальный интерфейс</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/interface/veth/add name=veth1 address=172.17.0.2/24 gateway=172.17.0.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Если нужно настроить для этого адреса NAT, добавить в bridge, проверить правила firewall</p>
<p>Настройка конфигурации <strong>container</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/container/config/set ram-high=200 registry-url=https://registry-1.docker.io tmpdir=usb1/tm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><a href="https://akmalov.com/assets/files/routeros-container-config-747ff0a5a704aaefa0af37142ac4b1e9.png" target="_blank"><img decoding="async" loading="lazy" alt="routeros-container-config" src="https://akmalov.com/assets/images/routeros-container-config-747ff0a5a704aaefa0af37142ac4b1e9.png" width="1067" height="452" class="img_ev3q"></a></p>
<p><strong>RAM Hight</strong> - Ограничение использования оперативной памяти (по умолчанию без лимита, рекомендую указать)</p>
<p><strong>Mount Points</strong></p>
<p>Точки монтирования зависят от конфигурации которую планируется использовать.</p>
<blockquote>
<p>Свою конфигурацию NGINX <a href="https://github.com/akmalovaa/mikrotik-nginx" target="_blank" rel="noopener noreferrer">прикладываю на Github</a></p>
</blockquote>
<p>Структура каталогов:
<a href="https://akmalov.com/assets/files/nginx-dir-8acbf5e9de979fdf4db9d800355f6cd6.png" target="_blank"><img decoding="async" loading="lazy" alt="nginx-dir" src="https://akmalov.com/assets/images/nginx-dir-8acbf5e9de979fdf4db9d800355f6cd6.png" width="900" height="500" class="img_ev3q"></a></p>
<p>В моей конфигурации для упрощения все хосты находятся в отдельных файлах
<code>config/proxy_host/*.conf</code>. Удобно при добавлении/удалении новых хостов - просто скопировать файл и изменить адрес, порт, домен (для отключения просто удалить файл). Остальные файлы конфигурации при этом можно вообще не трогать.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/container/mounts/add dst=/etc/nginx/nginx.conf name=nginx_conf src=/usb1/nginx/nginx.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/container/mounts/add dst=/etc/nginx/certs name=certs src=/usb1/nginx/certs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/container/mounts/add dst=/data name=nginx_data src=/usb1/nginx/data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/container/mounts/add dst=/etc/nginx/conf.d name=nginx_confd src=/usb1/nginx/config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Работа с файлами</div><div class="admonitionContent_BuS1"><p>Для удобства конфигурации и работы с файлами можно включить <strong>IP -&gt; SMB</strong> и расшарить USB по сети</p></div></div>
<p>Буду использовать <a href="https://hub.docker.com/_/nginx" target="_blank" rel="noopener noreferrer">nginx alpine с docker hub</a>
На сегодня последняя версия это <code>nginx:1.25.3-alpine</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/container/add remote-image=nginx:1.25.3-alpine interface=veth1 root-dir=usb1/docker/nginx mounts=nginx_conf,nginx_confd,nginx_data,certs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Указать образ, виртуальный интерфейс, монтируемые директории,
<a href="https://akmalov.com/assets/files/mikrotik-container-4ff6aa0fa5e118009e7da0ea7f954d95.png" target="_blank"><img decoding="async" loading="lazy" alt="mikrotik-container" src="https://akmalov.com/assets/images/mikrotik-container-4ff6aa0fa5e118009e7da0ea7f954d95.png" width="977" height="647" class="img_ev3q"></a></p>
<p>Дополнительные возможности:</p>
<ul>
<li>передать ENV переменные</li>
<li>запускать контейнер при включении роутера</li>
<li>переопределять CMD и Entrypoint</li>
<li>и т.д.</li>
</ul>
<p><strong>root-dir</strong> - используется как изолированная файловая система для контейнера (в docker <strong>var/lib/docker/volume</strong>)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="итоги">Итоги<a href="https://akmalov.com/blog/mikrotik-nginx#%D0%B8%D1%82%D0%BE%D0%B3%D0%B8" class="hash-link" aria-label="Прямая ссылка на Итоги" title="Прямая ссылка на Итоги">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nginx-container">nginx container<a href="https://akmalov.com/blog/mikrotik-nginx#nginx-container" class="hash-link" aria-label="Прямая ссылка на nginx container" title="Прямая ссылка на nginx container">​</a></h3>
<p>NGINX запущен и работает, конфигурацию менять не очень удобно, как вариант можно использовать <strong>Nginx Proxy Manager</strong></p>
<p><strong>Nginx Proxy Manager</strong> - opensource проект, где в одном контейнере web-gui, db, nginx, certbot (и даже API для конфигурации)</p>
<ul>
<li><a href="https://github.com/NginxProxyManager/nginx-proxy-manager" target="_blank" rel="noopener noreferrer">Github проекта</a></li>
<li><a href="https://akmalov.com/blog/nginx-proxy-manager" target="_blank" rel="noopener noreferrer">Статья</a></li>
</ul>
<p>но, он использует гораздо больше <strong>RAM</strong> если на 1Gb запускать только его - думаю потянет.</p>
<p>Есть мысли как даже с минимальным nginx сделать удобнее изменение конфигурации, но пока ничего не сделано</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="container-stats">container stats<a href="https://akmalov.com/blog/mikrotik-nginx#container-stats" class="hash-link" aria-label="Прямая ссылка на container stats" title="Прямая ссылка на container stats">​</a></h3>
<p>На данный момент нет возможности удобно смотреть в mikrotik сколько ресурсов использует тот или иной контейнер, не очень удобно</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="что-еще-позапускать">что еще позапускать<a href="https://akmalov.com/blog/mikrotik-nginx#%D1%87%D1%82%D0%BE-%D0%B5%D1%89%D0%B5-%D0%BF%D0%BE%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA%D0%B0%D1%82%D1%8C" class="hash-link" aria-label="Прямая ссылка на что еще позапускать" title="Прямая ссылка на что еще позапускать">​</a></h3>
<ul>
<li>AdguardHome - можно, не особо требователен к ресурсам</li>
<li>Home Assistant - не хватит ресурсов</li>
<li>Альетрнативные reverse proxy - аналоги treafik, caddy</li>
<li>Python, bash, go - различные скрипты для расширения функциональности роутера</li>
<li>Prometheus exporter - было бы удобнее мониторить</li>
<li>Статичные сайты - без проблем</li>
<li>NextCloud, DB, S3, хранение файлов - попахивает извращением</li>
<li>Speedtest - различные контейнеры которые позволяют проверять канал, скорость USB + RAM наверное подставят</li>
</ul>
<p>Другие предложения, для чего еще можно использовать контейнеры в роутере микротик напижите пожалуйста в комментариях</p>]]></content>
        <category label="homelab" term="homelab"/>
        <category label="linux" term="linux"/>
        <category label="networks" term="networks"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Uptime-kuma self-hosted monitoring]]></title>
        <id>https://akmalov.com/blog/uptime-kuma</id>
        <link href="https://akmalov.com/blog/uptime-kuma"/>
        <updated>2023-11-06T10:00:00.000Z</updated>
        <summary type="html"><![CDATA[Простой и удобный способ мониторить хосты]]></summary>
        <content type="html"><![CDATA[<p>Внешний сервис для мониторинга доступности хостов</p>
<p><a href="https://akmalov.com/blog/uptime-kuma"><img decoding="async" loading="lazy" alt="uptime-kuma" src="https://akmalov.com/assets/images/uptime-kuma-logo-cc272605e170ba93a58faa0939fdc358.png" width="1500" height="500" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="внешний-мониторинг-хостов">Внешний мониторинг хостов<a href="https://akmalov.com/blog/uptime-kuma#%D0%B2%D0%BD%D0%B5%D1%88%D0%BD%D0%B8%D0%B9-%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3-%D1%85%D0%BE%D1%81%D1%82%D0%BE%D0%B2" class="hash-link" aria-label="Прямая ссылка на Внешний мониторинг хостов" title="Прямая ссылка на Внешний мониторинг хостов">​</a></h2>
<p>Для того чтобы проверять доступность своих сервисов снаружи (с интернета), необходим внешний инструмент мониторинга.
Это один из сервисов, которые приходится поднимать снаружи, не на своей инфраструктуре, т.к. внутренний мониторинг в этом деле не особо подходит, даже когда внутри все сервисы выглядят живыми, снаружи может не быть доступа по разным причинам.</p>
<p>Пробовал использовать разные варианты но самым простым оказался <strong>uptime-kuma</strong> сервис, который предоставляет простой и удобный способ мониторинга хостов.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="о-проекте-uptime-kuma">О проекте uptime-kuma<a href="https://akmalov.com/blog/uptime-kuma#%D0%BE-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B5-uptime-kuma" class="hash-link" aria-label="Прямая ссылка на О проекте uptime-kuma" title="Прямая ссылка на О проекте uptime-kuma">​</a></h2>
<p>Ссылка на <a href="https://github.com/louislam/uptime-kuma" target="_blank" rel="noopener noreferrer">Github</a></p>
<p>Основные плюсы:</p>
<ul>
<li>Большой выбор инструментов (способов) мониторинга HTTP, TCP, json, ping, DNS, Push, Steam сервисы, Docker контейнеры</li>
<li>Простой интуитивно понятный web интерфейс</li>
<li>Уведомления через Telegram, Discord, Gotify, Slack, Pushover, электронную почту (SMTP) и т.д.</li>
<li>Мультиязычный</li>
<li>Возможность создания отдельных страниц для предоставления общего доступа к статусам</li>
<li>Вывод результатов в графике</li>
<li>Информация о сертификатах SSL и сроках действия</li>
<li>Поддержка прокси-сервера</li>
<li>Поддержка 2FA (двухфакторной аутентификации)</li>
<li>Open-source</li>
</ul>
<p><a href="https://akmalov.com/assets/files/orig-f395a546e1b559d5a5008b8ec38b22e5.png" target="_blank"><img decoding="async" loading="lazy" alt="uptime-kuma" src="https://akmalov.com/assets/images/orig-f395a546e1b559d5a5008b8ec38b22e5.png" width="1024" height="641" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="установка">Установка<a href="https://akmalov.com/blog/uptime-kuma#%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0" class="hash-link" aria-label="Прямая ссылка на Установка" title="Прямая ссылка на Установка">​</a></h2>
<p>Планирую использовать облачный север от timeweb, можно взять сервер в РФ или заграницей</p>
<p><a href="https://akmalov.com/assets/files/timweb-server-254758ec7b3638d4bf1079e2bfbcfccd.png" target="_blank"><img decoding="async" loading="lazy" alt="uptime-kuma-server" src="https://akmalov.com/assets/images/timweb-server-254758ec7b3638d4bf1079e2bfbcfccd.png" width="1234" height="576" class="img_ev3q"></a></p>
<p>Подойдут минимальные характеристики, для удобства планирую использовать еще и доменное имя - <code>monitoring.example.com</code></p>
<ul>
<li><strong>OS</strong>: Ubuntu 22.02</li>
<li><strong>CPU</strong>: 1 x 2.8 ГГц</li>
<li><strong>RAM</strong>: 1 Gb</li>
<li><strong>SSD</strong>: 15 Gb</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-подготовка">1. Подготовка<a href="https://akmalov.com/blog/uptime-kuma#1-%D0%BF%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0" class="hash-link" aria-label="Прямая ссылка на 1. Подготовка" title="Прямая ссылка на 1. Подготовка">​</a></h3>
<p>Обновление пакетов и установка docker</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apt update &amp;&amp; apt upgrade -y &amp;&amp; apt install -y curl</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -fsSL https://get.docker.com -o get-docker.sh &amp;&amp; sudo sh get-docker.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Конфигурация DNS перенаправление <code>monitoring.example.com</code> - на полученный белый IP от timeweb</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-настройка-docker-composeyaml">2. Настройка docker-compose.yaml<a href="https://akmalov.com/blog/uptime-kuma#2-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-docker-composeyaml" class="hash-link" aria-label="Прямая ссылка на 2. Настройка docker-compose.yaml" title="Прямая ссылка на 2. Настройка docker-compose.yaml">​</a></h3>
<div class="language-YAML language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'3.8'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">caddy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> caddy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">2.7.5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token datetime number" style="color:rgb(247, 140, 108)">80:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> 443</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./Caddyfile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/etc/caddy/Caddyfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">uptime-kuma</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> louislam/uptime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">kuma</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">1.23.3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">debian</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./uptime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">kuma</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/app/data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> always</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Для автоматического получения SSL сертификата использую Caddy и создаю файл конфигурации <strong>Caddyfile</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">touch</span><span class="token plain"> Caddyfile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Содержимое <strong>Caddyfile</strong>:</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">monitoring.example.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    reverse_proxy uptime-kuma</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">3001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Запуск контейнера</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker compose up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="запуск-и-настройка">Запуск и настройка<a href="https://akmalov.com/blog/uptime-kuma#%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA-%D0%B8-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0" class="hash-link" aria-label="Прямая ссылка на Запуск и настройка" title="Прямая ссылка на Запуск и настройка">​</a></h2>
<p>После запуска контейнера, можно подключиться к веб панели по домену <strong>monitoring.example.com</strong>.</p>
<p>Proxy сервис Caddy сам сходит получит сертификат и будет перенаправлять на HTTPS</p>
<p>При первом подключении, нужно создать пользователя и придумать пароль</p>
<p>В настройках:</p>
<ul>
<li>Проверить временную зону</li>
<li>Переключить на темную тему</li>
<li>Сменить язык на удобный</li>
<li>Добавить настройки для Telegram уведомлений</li>
</ul>
<p>Далее можно уже добавить первый монитор</p>
<p><a href="https://akmalov.com/assets/files/main-site-15cb66bcb13deb8e976b6db0ce1d649e.png" target="_blank"><img decoding="async" loading="lazy" alt="uptime-kuma-server" src="https://akmalov.com/assets/images/main-site-15cb66bcb13deb8e976b6db0ce1d649e.png" width="1872" height="940" class="img_ev3q"></a></p>
<p>По всем настройкам интерфейса, делать скрины и подробно расписывать не вижу смысла, все и так интуитивно понятно, а если вдруг хочется посмотреть и потыкаться, то на офф странице есть <a href="https://uptime.kuma.pet/" target="_blank" rel="noopener noreferrer">демо</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="итоги">Итоги<a href="https://akmalov.com/blog/uptime-kuma#%D0%B8%D1%82%D0%BE%D0%B3%D0%B8" class="hash-link" aria-label="Прямая ссылка на Итоги" title="Прямая ссылка на Итоги">​</a></h2>
<p>Мне очень понравился этот сервис, из того, что точно буду использовать:</p>
<ul>
<li>GET запрос для проверки сайта</li>
<li>ping серверов</li>
<li>проверка ответов API сервисов</li>
<li>оповещения в telegram</li>
<li>мониторинг срока действия ssl сертификатов</li>
</ul>
<p>Использование ресурсов (поднятый docker + 10 точек мониторинга занимают 140Mb RAM и минимальное CPU)</p>
<p>Из необычного, что впечатлило:</p>
<ul>
<li>Есть реверс проверка статуса (когда наоборот, если монитор стал доступен, то как ошибку воспринимать)</li>
<li>Push мониторинг - когда конечный сервис например за Proxy, NAT и нет к нему прямого доступа, можно с этого сервера Push отправлять на север uptime-kuma, которые он будет получать и мониторить</li>
<li>Специфичные средства мониторинга (Steam игровой сервер, PostgreSQL, Redis, Kafka, MongoDB и т.д.)</li>
<li>Можно создать дополнительную страницу, где вывести необходимые мониторы и поделиться ссылкой для просмотра (без аутентификации)</li>
</ul>
<p>Из минусов это единственная точка(узел) мониторинга и если будут проблемы на стороне облачного провайдера, то внешний мониторинг встанет, так же мониторинг с единственного узла не всегда показывает полную картину (например с других стран могут быть проблемы, о которых не получится оперативно узнать)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="бонус">Бонус<a href="https://akmalov.com/blog/uptime-kuma#%D0%B1%D0%BE%D0%BD%D1%83%D1%81" class="hash-link" aria-label="Прямая ссылка на Бонус" title="Прямая ссылка на Бонус">​</a></h3>
<p>Для минуса который описал выше, есть небольшое бесплатное решение, это мониторинг Selectel</p>
<p><a href="https://akmalov.com/assets/files/selectel-43891573f3dc3d8e4cdc8380a38ed54f.png" target="_blank"><img decoding="async" loading="lazy" alt="selectel мониторинг" src="https://akmalov.com/assets/images/selectel-43891573f3dc3d8e4cdc8380a38ed54f.png" width="1580" height="464" class="img_ev3q"></a></p>
<p>Если войти с панель управления под своим аккаунтом, можно бесплатно поставить в мониторинг до 3 метрик</p>
<p>Здесь так же имеются различные типы метрик, гибкие настройки, но самое главное 8 раличных точек мониторинга
<a href="https://akmalov.com/assets/files/selectel_get-011d52d7f400f7dafb38bd2c03311f61.png" target="_blank"><img decoding="async" loading="lazy" alt="selectel мониторинг" src="https://akmalov.com/assets/images/selectel_get-011d52d7f400f7dafb38bd2c03311f61.png" width="1118" height="572" class="img_ev3q"></a></p>
<ul>
<li>Франкфурт</li>
<li>Лондон</li>
<li>Амстердам</li>
<li>Москва</li>
<li>Новосибирск</li>
<li>Санкт-Петербург</li>
<li>Нью-Йорк</li>
<li>Сан-Франциско</li>
</ul>
<p>Возможно, кому хватит такого количества метрик и нет желания поднимать и настраивать облачный сервер, данный вариант покажется даже удобнее.</p>]]></content>
        <category label="monitoring" term="monitoring"/>
        <category label="docker" term="docker"/>
        <category label="ssl" term="ssl"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Auto wildcard cert service]]></title>
        <id>https://akmalov.com/blog/wildcard-ssl-cert</id>
        <link href="https://akmalov.com/blog/wildcard-ssl-cert"/>
        <updated>2023-09-23T10:00:00.000Z</updated>
        <summary type="html"><![CDATA[Простой способ получить wildcard ssl сертификат для своего домена с использованием Cloudflare и acme.sh]]></summary>
        <content type="html"><![CDATA[<p>Простой способ получить wildcard SSL сертификат для своего домена с использованием Cloudflare и acme.sh</p>
<p><a href="https://akmalov.com/blog/wildcard-ssl-cert"><img decoding="async" loading="lazy" alt="wildcard ssl cert" src="https://akmalov.com/assets/images/wildcard-logo-b96826c9a1c679c2e1aa0962a1f3f713.png" width="1498" height="500" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wildcard-сертификат">Wildcard сертификат<a href="https://akmalov.com/blog/wildcard-ssl-cert#wildcard-%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82" class="hash-link" aria-label="Прямая ссылка на Wildcard сертификат" title="Прямая ссылка на Wildcard сертификат">​</a></h2>
<p>Нравится изучать различные OpenSource проекты, и сейчас для многих сервисов которые запускаю у себя на серверах требуются доверенные сертификаты SSL</p>
<p>Имеется свой собственный домен <code>akmalov.com</code> и поддмены следующего уровня <code>*.akmalov.com</code> создавать в любом количестве и не проблема</p>
<p>Раньше пробовал использовать свой центр сертификации, прописывал в доверенных, создавал сампоподисанные сертификаты (очень неудобно, слишком много ресурсов для песочницы).
Далее решил перейти на скрипты и для отдельных поддоменов заказывал сертификаты с помощью <strong>Let's Encrypt</strong> и когда поддоменов набралось больше десятка решил попробовать <strong>wildcard</strong> сертификат, который может быть применен для всех поддоменов.</p>
<blockquote>
<p>Один сертификат для всех поддоменов</p>
</blockquote>
<p><a href="https://akmalov.com/assets/files/wildcard-baf20bbce2641b2b9185a38df454ec3f.jpg" target="_blank"><img decoding="async" loading="lazy" alt="wildcard" src="https://akmalov.com/assets/images/wildcard-baf20bbce2641b2b9185a38df454ec3f.jpg" width="942" height="408" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="acme-shell-script">ACME Shell script<a href="https://akmalov.com/blog/wildcard-ssl-cert#acme-shell-script" class="hash-link" aria-label="Прямая ссылка на ACME Shell script" title="Прямая ссылка на ACME Shell script">​</a></h2>
<p>После того как перепробовал различные варианты получения сертификатов, для меня самым удобным показался <strong>acme.sh</strong></p>
<p>Ссылка на офф <a href="https://github.com/acmesh-official/acme.sh" target="_blank" rel="noopener noreferrer">Github</a></p>
<ul>
<li>Unix shell скрипт без лишних зависимостей</li>
<li>Не нужны root права</li>
<li>Есть docker образ</li>
<li>Поддерживает IPv6</li>
<li>Можно использовать в cron-job для автоматического обновления сертификатов</li>
<li>Простые команды для управления</li>
<li>Умеет по API обращаться к Cloudflare</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cloudflare">Cloudflare<a href="https://akmalov.com/blog/wildcard-ssl-cert#cloudflare" class="hash-link" aria-label="Прямая ссылка на Cloudflare" title="Прямая ссылка на Cloudflare">​</a></h2>
<p>Для управлениями DNS записями домена использую Cloudflare, из за его популярности и возможности управления по API, для многих сервисов есть очень удобные интеграции. Одна из причин выбора acme.sh это как раз, то что он дружит Cloudflare.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>примечание</div><div class="admonitionContent_BuS1"><p>Если используется другой DNS провайдер, можно использовать ручной способ указанный в документации, где придется вручную создавать <code>TXT</code> записи в админке домена</p></div></div>
<p>Пошагово получение API токена в Cloudflare:</p>
<ul>
<li>Войти в свой аккаунт <a href="https://dash.cloudflare.com/" target="_blank" rel="noopener noreferrer">Cloudflare</a></li>
<li>Нажать на иконку профиля в верхней части экрана и выбрать <strong>My Profile</strong> в выпадающем меню.</li>
<li>Далее выберите <strong>API Tokens</strong> на левой панели меню.</li>
<li>Нажать на кнопку <strong>Create Token</strong> в верхней части страницы.</li>
<li>Выбрать тип токена, который нужен, задать параметры и уровень доступа для токена.</li>
<li>На странице созданного токена нужно скопировать  <strong>API Token</strong> и сохранить его (отображается только при создании больше его увидеть не получится, только пересоздать)</li>
</ul>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Осторожно</div><div class="admonitionContent_BuS1"><p>Токен нельзя светить где попало</p></div></div>
<p><a href="https://akmalov.com/assets/files/cloudflare-api-010f4fa6a891018ed0ab788080a40177.png" target="_blank"><img decoding="async" loading="lazy" alt="Cloudflare" src="https://akmalov.com/assets/images/cloudflare-api-010f4fa6a891018ed0ab788080a40177.png" width="1285" height="483" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="docker-acmesh">Docker acme.sh<a href="https://akmalov.com/blog/wildcard-ssl-cert#docker-acmesh" class="hash-link" aria-label="Прямая ссылка на Docker acme.sh" title="Прямая ссылка на Docker acme.sh">​</a></h2>
<p>Как один из больших поклонников контейнеров, не фанат устанавливать что-либо на хост систему, даже если это просто копирование скриптов.
Разработчики данного сервиса такого же мнения 💕</p>
<p>Страница на Github - <a href="https://github.com/acmesh-official/acme.sh/wiki/Run-acme.sh-in-docker" target="_blank" rel="noopener noreferrer"><strong>Run acme.sh in docker</strong></a></p>
<p>Официальный образ <a href="https://hub.docker.com/r/neilpang/acme.sh" target="_blank" rel="noopener noreferrer"><strong>Dockerhub</strong></a></p>
<p>Загрузить последнюю версию или tag <code>latest</code>, привык использовать конкретную версию:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> pull neilpang/acme.sh:3.0.6 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Для удобства с переменными буду использовать <code>.env</code> файл, следующего содержания:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">EMAIL=artur@example.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">URL=example.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WILDCARD_URL=*.example.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CF_Token=Your cloudflare API TOKEN</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>В начале необходимо выполнить команду регистрации ACME по <strong>email</strong>, которая будет использоваться для создания ключа.</p>
<p>Полученный в результате файл, нужен будет для запуска следующей команды и поэтому его необходимо сохранить вне контейнера.</p>
<p>Команда <code>-v "./acme_data":/acme.sh</code> позволит создать локально на хосте директорию в которую будут сохраняться полученные файлы и останутся даже когда контейнер отработает и закроется.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">--rm</span><span class="token plain"> --env-file .env </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-v</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"./acme_data"</span><span class="token plain">:/acme.sh neilpang/acme.sh:3.0.6 --register-account </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-m</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$EMAIL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>В логах должно быть сообщение об успешной регистрации аккаунта</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Create account key ok.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Registered</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; ACCOUNT_THUMBPRINT='ACCOUNT KEY'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Запрос <strong>wildcard</strong> сертификата</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">--rm</span><span class="token plain"> --env-file .env </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-v</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"./acme_data"</span><span class="token plain">:/acme.sh neilpang/acme.sh:3.0.6 </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">--issue</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-d</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$URL</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-d</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$WILDCARD_URL</span><span class="token plain">  </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">--dns</span><span class="token plain"> dns_cf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Процесс занимает примерно 3-7 минут</p>
<p>В логах по результатам запроса:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Multi domain='DNS:example.com,DNS:*.example.com'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Getting domain auth token for each domain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Getting webroot for domain='example.com'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Getting webroot for domain='*.example.com'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Adding record</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Added, OK</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; The txt record is added: Success.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Let's check each DNS record now. Sleep 20 seconds first.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Checking example.com for _acme-challenge.example.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Domain example.com '_acme-challenge.example.com' success.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; All success, let's return</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Verifying: example.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Processing, The CA is processing your order, please just wait. (1/30)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Success</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Removing DNS records.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Removed: Success</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Downloading cert.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Cert success.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Сертификат получен и готов для использования (срок 3 месяца), все файлы сохранены локально в директории <code>./acme_data</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-la</span><span class="token plain"> acme_data/example.com_ecc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r-- 1456 Sep 24 18:33 example.com.cer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r--  566 Sep 24 18:33 example.com.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r--  477 Sep 24 18:29 example.com.csr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r--  202 Sep 24 18:29 example.com.csr.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-------  227 Sep 24 18:28 example.com.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r-- 2668 Sep 24 18:33 ca.cer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r-- 4124 Sep 24 18:33 fullchain.cer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Можно проверить полученный сертификат командой:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">openssl x509 </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-in</span><span class="token plain"> acme_data/example.com_ecc/example.com.cer </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-text</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-noout</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>или онлайн сервисом <a href="https://www.sslshopper.com/certificate-decoder.html" target="_blank" rel="noopener noreferrer">Certificate Decoder</a></p>
<p>Дальше тоже можно автоматизировать, создав расписание на выполнение и отправку результатов куда нужно.</p>]]></content>
        <category label="docker" term="docker"/>
        <category label="homelab" term="homelab"/>
        <category label="ssl" term="ssl"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Monitoring web hosts]]></title>
        <id>https://akmalov.com/blog/monitoring-web-hosts</id>
        <link href="https://akmalov.com/blog/monitoring-web-hosts"/>
        <updated>2023-07-13T10:42:00.000Z</updated>
        <summary type="html"><![CDATA[monitoring web ssl certificate expried uptime kuma grafana prometheus docker]]></summary>
        <content type="html"><![CDATA[<p>self-hosted сервер мониторинга доступности хостов, времени действия SSL сертификатов с оповещениями в telegram</p>
<p><a href="https://akmalov.com/blog/monitoring-web-hosts"><img decoding="async" loading="lazy" alt="Monitoring web hosts" src="https://akmalov.com/assets/images/monitoring-web-hosts-logo-b1ba2ab5f07b6e69140fa7c31431038e.png" width="1500" height="500" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uptime-kuma">Uptime-kuma<a href="https://akmalov.com/blog/monitoring-web-hosts#uptime-kuma" class="hash-link" aria-label="Прямая ссылка на Uptime-kuma" title="Прямая ссылка на Uptime-kuma">​</a></h2>
<p>Если вам нужен самый простой и удобный инструмент мониторинга хостов, который можно поднять у себя на сервере проще воспользоваться сервисом <code>Uptime-Kuma</code></p>
<p><a href="https://github.com/louislam/uptime-kuma" target="_blank" rel="noopener noreferrer">Uptime-Kuma</a></p>
<p><img decoding="async" loading="lazy" alt="Uptime-Kuma" src="https://akmalov.com/assets/images/uptime-kuma-87329102b96002a5c3aa7e6720f8c9e7.jpg" width="1024" height="641" class="img_ev3q"></p>
<p>Главные фишки:</p>
<ul>
<li>Мониторинг HTTP(s) / TCP / HTTP(s) Keyword / HTTP(s) Json Query / Ping / DNS</li>
<li>Лекго и просто развернуть в docker-compose</li>
<li>Удобный и понятный графический интерфейс</li>
<li>Оповещения в Telegram, Discord, Slack, Email (SMTP) и т.д.</li>
<li>Информация о сертификате (SSL Certificate info)</li>
<li>Поддержка Proxy и 2FA</li>
</ul>
<p>При обнаружении проблем с доступностью, Uptime-Kuma быстро уведомляет пользователя различными способами, включая такие популярные платформы, как Telegram, Discord и Slack.</p>
<p>Аналитические функции, такие как графики и статистика, предоставляют полезные данные для понимания причин проблем с доступностью, помогая пользователям своевременно реагировать и улучшать свои сервисы.</p>
<p>В целом, Uptime-Kuma - это незаменимый инструмент для тех, кто хочет быть уверенным в непрерывной работе и доступности своих веб-сервисов.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="сервер-мониторинга">Сервер мониторинга<a href="https://akmalov.com/blog/monitoring-web-hosts#%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80-%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3%D0%B0" class="hash-link" aria-label="Прямая ссылка на Сервер мониторинга" title="Прямая ссылка на Сервер мониторинга">​</a></h2>
<p>Если уже используется стэк для мониторинга Promeheus + Grafana можно воспользваться blackbox exporter и сделать удобный Dashboard для себя. Об этом сейчас и буду писать подробнее</p>
<p><strong>Простой пример мониторинга хостов и истечения срока действия SSL-сертификата</strong></p>
<p><a href="https://akmalov.com/assets/files/grafana-ssl-certificate-expires-694b82ef0991ebbc6730e8e1f0dae8d2.png" target="_blank"><img decoding="async" loading="lazy" alt="Grafana ssl certificate expires" src="https://akmalov.com/assets/images/grafana-ssl-certificate-expires-694b82ef0991ebbc6730e8e1f0dae8d2.png" width="1872" height="470" class="img_ev3q"></a></p>
<p>Используется следующие сервисы:</p>
<ul>
<li>Prometheus (сбор и база данных)</li>
<li>Grafana (отображение данных)</li>
<li>Blackbox (мониторинг http)</li>
<li>Alertmanager (уведомления)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="установка">Установка<a href="https://akmalov.com/blog/monitoring-web-hosts#%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0" class="hash-link" aria-label="Прямая ссылка на Установка" title="Прямая ссылка на Установка">​</a></h3>
<p>Сам проект на <a href="https://github.com/akmalovaa/monitoring-hosts-cert/tree/main" target="_blank" rel="noopener noreferrer">Github monitoring hosts</a></p>
<p>используется docker-compose 🐳</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/akmalovaa/monitoring-hosts-cert.git</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> monitoring-hosts-cert</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>Изменить конечные хосты <code>/prometheus/prometheus.yml</code></p>
</li>
<li>
<p>Настройка для отправки сообщений в телеграм <code>/alertmanager/config.yml</code></p>
</li>
<li>
<p>Добавить права на директорию для графаны:</p>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">chmod</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-R</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">777</span><span class="token plain"> data/grafana/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Запустить сервисы</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker-compose</span><span class="token plain"> up </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Проверить сервисы</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker-compose</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Telegram уведомления:
<img decoding="async" loading="lazy" alt="telegram alertmanager" src="https://akmalov.com/assets/images/telegram-alertmanager-1f0e17b64f4d7e7240786c611a44877d.png" width="805" height="378" class="img_ev3q"></p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="дополнительные-материалы">Дополнительные материалы<a href="https://akmalov.com/blog/monitoring-web-hosts#%D0%B4%D0%BE%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D0%BC%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%B0%D0%BB%D1%8B" class="hash-link" aria-label="Прямая ссылка на Дополнительные материалы" title="Прямая ссылка на Дополнительные материалы">​</a></h3>
<ul>
<li>
<p>Grafana labs - <a href="https://grafana.com/grafana/dashboards/13230-certificate-monitor/" target="_blank" rel="noopener noreferrer">Dashboard</a></p>
</li>
<li>
<p>Grafana blog - <a href="https://grafana.com/blog/2020/11/25/how-we-eliminated-service-outages-from-certificate-expired-by-setting-up-alerts-with-grafana-and-prometheus/" target="_blank" rel="noopener noreferrer">Post SSL alerting</a></p>
</li>
<li>
<p>Github Prometheus, Grafana, blackbox, alertmanager + caddy - <a href="https://github.com/stefanprodan/dockprom/tree/master" target="_blank" rel="noopener noreferrer">docker-compose example</a></p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="настройки-alertmanager-telegram">Настройки Alertmanager telegram<a href="https://akmalov.com/blog/monitoring-web-hosts#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8-alertmanager-telegram" class="hash-link" aria-label="Прямая ссылка на Настройки Alertmanager telegram" title="Прямая ссылка на Настройки Alertmanager telegram">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="bot-token">Bot token<a href="https://akmalov.com/blog/monitoring-web-hosts#bot-token" class="hash-link" aria-label="Прямая ссылка на Bot token" title="Прямая ссылка на Bot token">​</a></h5>
<p>Создайте бота и получите ключ API бота в канале <a href="https://t.me/BotFather" target="_blank" rel="noopener noreferrer">BotFather</a></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="получить-chat-id-telegram">Получить Chat ID telegram<a href="https://akmalov.com/blog/monitoring-web-hosts#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-chat-id-telegram" class="hash-link" aria-label="Прямая ссылка на Получить Chat ID telegram" title="Прямая ссылка на Получить Chat ID telegram">​</a></h5>
<p>Напишите пару тестовых сообщений созданному только что боту, затем выполните запрос</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> https://api.telegram.org/bot</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">TOKEN</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">/getUpdates </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> jq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="docker-compose">docker-compose<a href="https://akmalov.com/blog/monitoring-web-hosts#docker-compose" class="hash-link" aria-label="Прямая ссылка на docker-compose" title="Прямая ссылка на docker-compose">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">version: "3.7"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  prometheus:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    container_name: prometheus</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: prom/prometheus:v2.46.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    command:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - '--config.file=/etc/prometheus/prometheus.yml'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - '--storage.tsdb.path=/prometheus'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - '--web.console.libraries=/etc/prometheus/console_libraries'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - '--web.console.templates=/etc/prometheus/consoles'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - '--storage.tsdb.retention.time=30d'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - '--web.enable-lifecycle'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    user: root</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - 9090:9090</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - ./prometheus:/etc/prometheus/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - ./data/prometheus:/prometheus/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    restart: unless-stopped</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     - TZ="Asia/Yekaterinburg"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  blackbox:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    container_name: blackbox</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: prom/blackbox-exporter:v0.24.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    command:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - '--config.file=/config/blackbox.yml'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - 9115:9115</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    restart: unless-stopped</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - ./blackbox:/config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  alertmanager:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    container_name: alertmanager</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: prom/alertmanager:v0.25.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    command:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - '--config.file=/etc/alertmanager/config.yml'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - '--storage.path=/alertmanager'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - 9093:9093</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - ./alertmanager:/etc/alertmanager/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    restart: unless-stopped</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  grafana:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    container_name: grafana</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: grafana/grafana:10.0.3-ubuntu</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    depends_on:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - prometheus</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - 3000:3000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - ./data/grafana:/var/lib/grafana</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - ./grafana/dashboards:/etc/grafana/provisioning/dashboards</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - ./grafana/datasources:/etc/grafana/provisioning/datasources</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    restart: unless-stopped</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - GF_SECURITY_ADMIN_USER=${ADMIN_USER:-admin}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - GF_SECURITY_ADMIN_PASSWORD=${ADMIN_PASSWORD:-admin}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - GF_USERS_ALLOW_SIGN_UP=false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - TZ="Asia/Yekaterinburg"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="monitoring" term="monitoring"/>
        <category label="ssl" term="ssl"/>
        <category label="docker" term="docker"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Docusaurus комментарии]]></title>
        <id>https://akmalov.com/blog/docusaurus-comments</id>
        <link href="https://akmalov.com/blog/docusaurus-comments"/>
        <updated>2023-06-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Add commenst docusaurus, добавление коментариев в docusaurus с использованием Giscus]]></summary>
        <content type="html"><![CDATA[<p>Добавить комментарии, обсуждения в записях блога docusaurus</p>
<p><a href="https://akmalov.com/blog/docusaurus-comments"><img decoding="async" loading="lazy" alt="docusaurus comments" src="https://akmalov.com/assets/images/docusaurus-comments-434e8902a13264175b7df3a8acce9235.png" width="1500" height="500" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="комментарии-и-обсуждения-для-блога">Комментарии и обсуждения для блога<a href="https://akmalov.com/blog/docusaurus-comments#%D0%BA%D0%BE%D0%BC%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D1%80%D0%B8%D0%B8-%D0%B8-%D0%BE%D0%B1%D1%81%D1%83%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B4%D0%BB%D1%8F-%D0%B1%D0%BB%D0%BE%D0%B3%D0%B0" class="hash-link" aria-label="Прямая ссылка на Комментарии и обсуждения для блога" title="Прямая ссылка на Комментарии и обсуждения для блога">​</a></h2>
<p>На мой взгляд это очень полезная штука.</p>
<ul>
<li>Комментарии дают возможность высказаться и поделиться своим мнением, задать вопросы или дополнить тему статьи.</li>
<li>Для обсуждения идей и обмена знаниями, могут стимулировать дискуссии и помочь узнать что-то новое.</li>
</ul>
<p>Искал разные решения и в итоге остановился на <strong>Giscus</strong></p>
<p>Это opensource проект для добавления обсуждений через Discussions Github</p>
<p>Офф.сайт - <a href="https://giscus.app/ru" target="_blank" rel="noopener noreferrer">https://giscus.app/ru</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="настройка-github">Настройка Github<a href="https://akmalov.com/blog/docusaurus-comments#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-github" class="hash-link" aria-label="Прямая ссылка на Настройка Github" title="Прямая ссылка на Настройка Github">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="включить-обсуждения">Включить обсуждения<a href="https://akmalov.com/blog/docusaurus-comments#%D0%B2%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C-%D0%BE%D0%B1%D1%81%D1%83%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D1%8F" class="hash-link" aria-label="Прямая ссылка на Включить обсуждения" title="Прямая ссылка на Включить обсуждения">​</a></h3>
<p>Нужно активировать Discussion в настройках репозитория</p>
<p><img decoding="async" loading="lazy" alt="Discussion" src="https://akmalov.com/assets/images/discussions-enable-c0cf29e5f6d209e9f709bfdef3f613fa.png" width="1053" height="260" class="img_ev3q"></p>
<p>После этого для удобства удалил лишние категории, оставил только Generals</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="установка-giscus-app">Установка Giscus App<a href="https://akmalov.com/blog/docusaurus-comments#%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-giscus-app" class="hash-link" aria-label="Прямая ссылка на Установка Giscus App" title="Прямая ссылка на Установка Giscus App">​</a></h3>
<p>Установить для выбранного репозитория Giscus GitHub App</p>
<p><a href="https://github.com/apps/giscus" target="_blank" rel="noopener noreferrer">https://github.com/apps/giscus</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="настройка-giscus">Настройка Giscus<a href="https://akmalov.com/blog/docusaurus-comments#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-giscus" class="hash-link" aria-label="Прямая ссылка на Настройка Giscus" title="Прямая ссылка на Настройка Giscus">​</a></h2>
<p>Установка пакета</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm add @giscus/react</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Создание компонента</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm run swizzle @docusaurus/theme-classic BlogPostItem -- --wrap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Дання команда создаст файл по пути <code>src/theme/BlogPostItem/index.js</code></p>
<p>Переименовать файл в <strong>BlogPostItem.tsx</strong> и положить уровнем выше в итоге получится <code>src/theme/BlogPostItem.tsx</code></p>
<p>Содержание файла</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'react'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">BlogPostItem</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'@theme-original/BlogPostItem'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> useBlogPost </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"@docusaurus/theme-common/internal"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Giscus</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"@giscus/react"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">BlogPostItemWrapper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> isBlogPostPage </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useBlogPost</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">isBlogPostPage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">BlogPostItem</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag spread punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token tag spread" style="color:rgb(255, 85, 114)">props</span><span class="token tag spread punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">BlogPostItem</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag spread punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token tag spread" style="color:rgb(255, 85, 114)">props</span><span class="token tag spread punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">className</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">docusaurus-blog-comments</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">          </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Giscus</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">            </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">repo</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">akmalovaa/akmalov.com</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">            </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">repoId</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">R_kgDOI0gPCg</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">            </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">category</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">General</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">            </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">categoryId</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">DIC_kwDOI0gPCs4CXR_A</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">            </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">mapping</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">pathname</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">            </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">reactionsEnabled</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">1</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">            </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">emitMetadata</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">0</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">            </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">inputPosition</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">bottom</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">            </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">theme</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">dark</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">            </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">lang</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript string" style="color:rgb(195, 232, 141)">'ru'</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">            </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">loading</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">lazy</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">"</span><span class="token tag" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">          </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>подсказка</div><div class="admonitionContent_BuS1"><p>Можно сделать лучше и кусок с Giscus перенести в <code>src/components</code> а переменные через dotenv файл потдягивать</p></div></div>
<p>Пока буду делать просто и топорно, т.к. github Discussion сейчас активно развивается и возможны изменения в API - необходимо будет быстро исправить.</p>
<p>Пройдемся по переменным:</p>
<ul>
<li><code>repo</code> тут все понятно автор и репо</li>
<li><code>repoId</code> нужно будет вытащить через API</li>
<li><code>category</code> название категории в Discussion</li>
<li><code>categoryId</code> нужно будет вытащить через API</li>
</ul>
<p>Удобнее всего ID вытаскивать через GraphQL запрос вытаскивать.
Если уже установлена Github CLI то можно выполнить команду:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gh api graphql </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-f</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">query</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">'{ </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  repository(owner: "akmalovaa", name:"akmalov.com"){</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    discussionCategories(first:10) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">      edges {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        node {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">          id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">          name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">      }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Нужно подставить свои <strong>owner</strong> и repo <strong>name</strong>. В ответ придет json с ID репозитория и категорий.</p>
<p>Можно попробовать через Github API эти данные вытащить, но способ выше показался проще.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="итого">Итого<a href="https://akmalov.com/blog/docusaurus-comments#%D0%B8%D1%82%D0%BE%D0%B3%D0%BE" class="hash-link" aria-label="Прямая ссылка на Итого" title="Прямая ссылка на Итого">​</a></h2>
<p>Вроде без особых сложностей можно добавить комментарии в своем блоге с docusaurus.</p>
<p>Некоторые сервисы (аналоги giscus) используют для комментов <code>github issue</code>, но мне кажется <code>github discussions</code> лучше для этого подходит и по логике и по функционалу.</p>]]></content>
        <category label="docusaurus" term="docusaurus"/>
        <category label="github" term="github"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Gitlab auto add reviewers]]></title>
        <id>https://akmalov.com/blog/gitlab-auto-reviewers</id>
        <link href="https://akmalov.com/blog/gitlab-auto-reviewers"/>
        <updated>2023-05-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Gitlab auto assign reviewer for merge request]]></summary>
        <content type="html"><![CDATA[<p>Gitlab auto assign reviewer — Автоматическое подставление assignee и reviewers при создании mergre request</p>
<p><a href="https://akmalov.com/blog/gitlab-auto-reviewers"><img decoding="async" loading="lazy" alt="nginx logo" src="https://akmalov.com/assets/images/gitlab-reviewers-c3e4e494b3c1598ca2d3333cd210227a.png" width="1500" height="500" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="gitlab-auto-add-reviewers">Gitlab auto add reviewers<a href="https://akmalov.com/blog/gitlab-auto-reviewers#gitlab-auto-add-reviewers" class="hash-link" aria-label="Прямая ссылка на Gitlab auto add reviewers" title="Прямая ссылка на Gitlab auto add reviewers">​</a></h2>
<p><strong>Цель</strong>: при создании Merge Request сделать удобное добавление ревьюверов</p>
<p><img decoding="async" loading="lazy" alt="mr reviewers" src="https://akmalov.com/assets/images/mr-f18b428bbad8907030149a86c8b83e1f.png" title="mr reviewers" width="1292" height="750" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-reviewer-templates">1. Reviewer templates<a href="https://akmalov.com/blog/gitlab-auto-reviewers#1-reviewer-templates" class="hash-link" aria-label="Прямая ссылка на 1. Reviewer templates" title="Прямая ссылка на 1. Reviewer templates">​</a></h2>
<p>Первый способ который поможет в добавлении ревьюверов - это использование templates. Встроенная фича Gitlab, бесплатная для всех версий.</p>
<p>Документация - <a href="https://docs.gitlab.com/ee/user/project/description_templates.html" target="_blank" rel="noopener noreferrer">Description templates</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="подготовка">Подготовка<a href="https://akmalov.com/blog/gitlab-auto-reviewers#%D0%BF%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0" class="hash-link" aria-label="Прямая ссылка на Подготовка" title="Прямая ссылка на Подготовка">​</a></h3>
<p>Нужно создать директорию <code>.gitlab/merge_request_templates</code></p>
<p>Создать внутри любой файл расширения <code>.md</code></p>
<p>Например <code>top_reviewers.md</code></p>
<p>С таким содержанием, где нужно добавить username ревьюверов:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/assign_reviewer @user1 @user2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="gitlab template" src="https://akmalov.com/assets/images/gitlab-template-a81aa1e33546eba521e392c74d5b96c0.png" title="gitlab template" width="1283" height="328" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="использование">Использование<a href="https://akmalov.com/blog/gitlab-auto-reviewers#%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5" class="hash-link" aria-label="Прямая ссылка на Использование" title="Прямая ссылка на Использование">​</a></h3>
<p>После добавления такого template, при создании новых MR появится дополнительное поле, где можно выбрать созданные шаблоны</p>
<p><img decoding="async" loading="lazy" alt="gitlab template" src="https://akmalov.com/assets/images/gitlab-mr-template-44098fae936bf6b74d5cfb6958c9e6e1.png" title="gitlab template" width="1413" height="756" class="img_ev3q"></p>
<p>Удобный способ, особенно если несколько разных групп ревбюверов, можно создавать несколько частых шаблонов и использовать их.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-bash-gitlab-api">2. Bash gitlab API<a href="https://akmalov.com/blog/gitlab-auto-reviewers#2-bash-gitlab-api" class="hash-link" aria-label="Прямая ссылка на 2. Bash gitlab API" title="Прямая ссылка на 2. Bash gitlab API">​</a></h2>
<p>Данный способ - добавление скрипта в <code>.gitlab-ci.yml</code> CI/CD, который позволит через API автоматический добавлять ревьюверов</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="подготовка-1">Подготовка<a href="https://akmalov.com/blog/gitlab-auto-reviewers#%D0%BF%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0-1" class="hash-link" aria-label="Прямая ссылка на Подготовка" title="Прямая ссылка на Подготовка">​</a></h3>
<p>Для отслеживания создания merge request можно использовать разные события(триггеры):</p>
<ul>
<li>Gitlab CI workflow event</li>
<li>Schedules</li>
<li>Прочие события</li>
</ul>
<p>Я буду использовать <code>workflow — merge request event</code>, для этого добавил в <strong>workflow</strong> триггер на создание MR:</p>
<div class="language-YAML language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $CI_PIPELINE_SOURCE == "merge_request_event"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Переменные <strong>Settings -&gt; CI/CD -&gt; Variables</strong></p>
<ul>
<li><code>$TOKEN</code> - Gitlab API Token</li>
</ul>
<p>В gitlab runner где запускается pipeline нужен jq
Заранее установленый или доставить перед запуском скрипта:</p>
<div class="language-YAML language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">before_script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> apt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">get install jq </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="скрипт">Скрипт<a href="https://akmalov.com/blog/gitlab-auto-reviewers#%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82" class="hash-link" aria-label="Прямая ссылка на Скрипт" title="Прямая ссылка на Скрипт">​</a></h3>
<p>Пошаговая логика скрипта:</p>
<ul>
<li>Получить последний merge request ID</li>
<li>Получить ID автора merge request</li>
<li>Назначить Assigne = ID Автора</li>
<li>Назначить Reviewers = из переменной  Reviewers(list)</li>
</ul>
<div class="language-YAML language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">variables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">PROJECT_URL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'https://gitlab.com/api/v4/projects/$CI_PROJECT_ID/merge_requests'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">REVIEWERS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'10043654'</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Reviewers Gitlab ID List</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">.gitlab_add_assignee_reviewers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">stage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> set up merge request</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> read LAST_MR_ID &lt; &lt;(curl </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">header "PRIVATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">TOKEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">$TOKEN" "$PROJECT_URL" </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> jq '.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> .iid')</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> read MR_AUTHOR &lt; &lt;(curl </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">header "PRIVATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">TOKEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">$TOKEN" "$PROJECT_URL/$LAST_MR_ID" </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> jq '.author </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> .id')</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># add assignee</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> curl </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">s </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">request PUT </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">header "PRIVATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">TOKEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">$TOKEN" "$PROJECT_URL/$LAST_MR_ID" </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">form "assignee_ids=$MR_AUTHOR" </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> jq '.assignees'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># add reviewers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> curl </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">s </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">request PUT </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">header "PRIVATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">TOKEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">$TOKEN" "$PROJECT_URL/$LAST_MR_ID" </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">form "reviewer_ids=$REVIEWERS"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-python-gitlab-api">3. Python gitlab API<a href="https://akmalov.com/blog/gitlab-auto-reviewers#3-python-gitlab-api" class="hash-link" aria-label="Прямая ссылка на 3. Python gitlab API" title="Прямая ссылка на 3. Python gitlab API">​</a></h2>
<p>Данный вариант более гибкий и удобный в плане доработок под разные условия.
Есть так же возможность вызывать как python script в <code>gitlab-ci</code></p>
<p>Полный код на <a href="https://github.com/akmalovaa/gitlab-auto-add-reviewers/tree/master/Python" target="_blank" rel="noopener noreferrer">github</a></p>
<p>Python/settings.py</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">GITLAB_API_ADDR </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'&lt;https://gitlab.com&gt;'</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Your Gitlab URL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GITLAB_TOKEN</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">'YOUR GITLAB API TOKEN'</span><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># API Token use import .env</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GITLAB_ROOT_GROUP </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain">                      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Root Group optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GITLAB_REVIEWERS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">list</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">10043654</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">         </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Gitlab Reviewrs ID</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Python/main.py</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> settings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> typing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gl </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Gitlab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">GITLAB_API_ADDR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> private_token</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">GITLAB_TOKEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_last_merge_requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">""" Get last merg request """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">GITLAB_ROOT_GROUP </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        all_mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> typing</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Any </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> gl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">mergerequests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">list</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">state</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">"opened"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        all_mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> typing</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Any </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> gl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">groups</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">GITLAB_ROOT_GROUP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">mergerequests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">list</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">state</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">"opened"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        last_mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">v4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">merge_requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">MergeRequest </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> all_mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">except</span><span class="token plain"> IndexError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">"Merge requests - Not found"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    _auto_add_responsible</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">last_mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_auto_add_responsible</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">v4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">merge_requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">GroupMergeRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    project</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">v4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">projects</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Project </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> gl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">projects</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">project_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lazy</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    editable_mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">v4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">merge_requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ProjectMergeRequest </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        project</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">mergerequests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">iid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lazy</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    editable_mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">assignee_id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">author</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">"id"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    editable_mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">reviewer_ids </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">GITLAB_REVIEWERS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">editable_mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    editable_mr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">save</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"__main__"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    get_last_merge_requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>example for <code>.gitlab-ci.yml</code></p>
<div class="language-YAML language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">.python_add_reviewers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> pip install virtualenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> virtualenv venv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> source venv/bin/activate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> pip install </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">r Python/requirements.txt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> python Python/main.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="gitlab" term="gitlab"/>
        <category label="devops" term="devops"/>
        <category label="bash" term="bash"/>
        <category label="python" term="python"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Мониторинг для компьютерного клуба]]></title>
        <id>https://akmalov.com/blog/monitoring-pc-club</id>
        <link href="https://akmalov.com/blog/monitoring-pc-club"/>
        <updated>2023-05-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Система мониторинга в компьютерном клубе]]></summary>
        <content type="html"><![CDATA[<p>Система мониторинга дает возможность отслеживать и оперативно узнавать об ошибках в работе и общей нагрузке на оборудование.</p>
<p><a href="https://akmalov.com/blog/monitoring-pc-club"><img decoding="async" loading="lazy" alt="Releases update info" src="https://akmalov.com/assets/images/monitoring-pc-club-037f03ec2b5601108df6ba3e3bccce1c.png" width="1500" height="500" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="зачем-мониторинг">Зачем мониторинг?<a href="https://akmalov.com/blog/monitoring-pc-club#%D0%B7%D0%B0%D1%87%D0%B5%D0%BC-%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3" class="hash-link" aria-label="Прямая ссылка на Зачем мониторинг?" title="Прямая ссылка на Зачем мониторинг?">​</a></h2>
<p>Благодаря мониторингу можно увидеть полноценную картину использования и работоспособности оборудования.</p>
<p>Позволяет многие технические проблемы решать до их проявления и улучшать качество обслуживания пользователей.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="что-мониторить">Что мониторить?<a href="https://akmalov.com/blog/monitoring-pc-club#%D1%87%D1%82%D0%BE-%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D1%82%D1%8C" class="hash-link" aria-label="Прямая ссылка на Что мониторить?" title="Прямая ссылка на Что мониторить?">​</a></h2>
<ul>
<li>CPU (нагрузка на процессор, температура)</li>
<li>GPU (нагрузка на видеокарту, температура)</li>
<li>RAM (нагрузка на оперативную память)</li>
<li>SSD, HDD (состояние дисков, свободный объем)</li>
<li>Любая другая полезная информация, которую необходимо вывести</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="как-мониторить">Как мониторить?<a href="https://akmalov.com/blog/monitoring-pc-club#%D0%BA%D0%B0%D0%BA-%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D1%82%D1%8C" class="hash-link" aria-label="Прямая ссылка на Как мониторить?" title="Прямая ссылка на Как мониторить?">​</a></h2>
<p>Основная связка Prometheus + Grafana</p>
<p>Это самые популярные сервисы для мониторинга, быстрые и удобные</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prometheus">Prometheus<a href="https://akmalov.com/blog/monitoring-pc-club#prometheus" class="hash-link" aria-label="Прямая ссылка на Prometheus" title="Прямая ссылка на Prometheus">​</a></h3>
<p>Собирает и хранит все метрики. Сам ходит к каждому компьютеры и собирает нужную информацию</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="grafana">Grafana<a href="https://akmalov.com/blog/monitoring-pc-club#grafana" class="hash-link" aria-label="Прямая ссылка на Grafana" title="Прямая ссылка на Grafana">​</a></h3>
<p>Берет  данные с Prometheus и позволяет красиво все отобразить. Главная панель мониторинга</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exporters">Exporters<a href="https://akmalov.com/blog/monitoring-pc-club#exporters" class="hash-link" aria-label="Прямая ссылка на Exporters" title="Прямая ссылка на Exporters">​</a></h3>
<p><strong>Экспортер</strong> - представляет собой службу, которая собирает информацию о системе и подготавливает ее в формате понятным для Prometheus. На каждом компьютере с которого нужная информация, должен быть запущен exporter</p>
<p><img decoding="async" loading="lazy" alt="monitoring" src="https://akmalov.com/assets/images/monitoring-cff136765f316f2616afe51fab89adb4.jpg" width="3000" height="2000" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="подготовка-сервера">Подготовка сервера<a href="https://akmalov.com/blog/monitoring-pc-club#%D0%BF%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0" class="hash-link" aria-label="Прямая ссылка на Подготовка сервера" title="Прямая ссылка на Подготовка сервера">​</a></h2>
<p>Сервер или виртуалка с Linux (я использовал Ubuntu но для docker разницы нет)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-compose">docker-compose<a href="https://akmalov.com/blog/monitoring-pc-club#docker-compose" class="hash-link" aria-label="Прямая ссылка на docker-compose" title="Прямая ссылка на docker-compose">​</a></h3>
<p>Для удобства обслуживания будет использоваться docker-compose</p>
<div class="language-YAML language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"3.7"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">prometheus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> prom/prometheus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">v2.44.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'--config.file=/etc/prometheus/prometheus.yml'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'--storage.tsdb.path=/prometheus'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'--web.console.libraries=/etc/prometheus/console_libraries'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'--web.console.templates=/etc/prometheus/consoles'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'--storage.tsdb.retention.time=30d'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'--web.enable-lifecycle'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'--web.external-url=https://prom.akmalov.com'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> TZ="Asia/Yekaterinburg"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> 9090</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./prometheus/config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/etc/prometheus/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./prometheus/data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/prometheus/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">grafana</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> grafana/grafana</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">9.5.3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">ubuntu</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> grafana</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> 3000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./grafana/data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/var/lib/grafana</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./grafana/provisioning</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/etc/grafana/provisioning</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> GF_SECURITY_ADMIN_USER=admin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> GF_SECURITY_ADMIN_PASSWORD=12345</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> GF_USERS_ALLOW_SIGN_UP=false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> TZ="Asia/Yekaterinburg"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> BROWSER_TZ="Asia/Yekaterinburg"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">stopped</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="конфигурация-prometheus">Конфигурация prometheus<a href="https://akmalov.com/blog/monitoring-pc-club#%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F-prometheus" class="hash-link" aria-label="Прямая ссылка на Конфигурация prometheus" title="Прямая ссылка на Конфигурация prometheus">​</a></h3>
<p>Создать файл конфига по пути:
<code>./prometheus/config/prometheus.yml </code></p>
<p>В данном примере добавлены 5 ПК, отдельные job для Windows и GPU экспортеров</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">global:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  scrape_interval:     15s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  evaluation_interval: 15s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - job_name: 'GPU'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metrics_path: '/metrics'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scrape_interval: 5s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    static_configs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - targets:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - 192.168.18.11:9835</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - 192.168.18.12:9835</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - 192.168.18.13:9835</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - 192.168.18.14:9835</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - 192.168.18.15:9835</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        labels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          metrics: nvidia</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - job_name: 'Windows'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metrics_path: '/metrics'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scrape_interval: 5s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    static_configs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - targets:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - 192.168.18.11:9182</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - 192.168.18.12:9182</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - 192.168.18.13:9182</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - 192.168.18.14:9182</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - 192.168.18.15:9182</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        labels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          metrics: OS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Создание config файла можно сильно упросить и автоматизировать с помощью Ansible</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="подготовка-компьютеров">Подготовка компьютеров<a href="https://akmalov.com/blog/monitoring-pc-club#%D0%BF%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0-%D0%BA%D0%BE%D0%BC%D0%BF%D1%8C%D1%8E%D1%82%D0%B5%D1%80%D0%BE%D0%B2" class="hash-link" aria-label="Прямая ссылка на Подготовка компьютеров" title="Прямая ссылка на Подготовка компьютеров">​</a></h2>
<p>В данном случаи понадобиться установить два экспортера:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows-exporter"><a href="https://github.com/prometheus-community/windows_exporter" target="_blank" rel="noopener noreferrer">windows exporter</a><a href="https://akmalov.com/blog/monitoring-pc-club#windows-exporter" class="hash-link" aria-label="Прямая ссылка на windows-exporter" title="Прямая ссылка на windows-exporter">​</a></h3>
<p><a href="https://github.com/prometheus-community/windows_exporter" target="_blank" rel="noopener noreferrer">Windows Exporter</a> - позволяет мониторить состояние операционной системы Windows и собирать метрики для дальнейшей обработки, выводит различные параметры и характеристики Windows, такие как:</p>
<ul>
<li>Использование процессора и памяти;</li>
<li>Загрузка дисков и средств хранения;</li>
<li>Статистика сетевых интерфейсов;</li>
<li>Статистика работы служб и сервисов Windows;</li>
<li>Информация о запущенных процессах и открытых сокетах;</li>
<li>Информация о состоянии производительности IIS и многие другие параметры.</li>
</ul>
<p>Использование Windows Exporter позволяет проводить мониторинг и анализ состояния Windows и быстро реагировать на возможные проблемы, такие как ограниченная производительность, низкая доступность ресурсов и другие. Благодаря этому инструменту можно повысить стабильность и надежность работы системы Windows, а также улучшить качество обслуживания пользователей.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nvidia-gpu-exporter"><a href="https://github.com/utkuozdemir/nvidia_gpu_exporter" target="_blank" rel="noopener noreferrer">nvidia gpu exporter</a><a href="https://akmalov.com/blog/monitoring-pc-club#nvidia-gpu-exporter" class="hash-link" aria-label="Прямая ссылка на nvidia-gpu-exporter" title="Прямая ссылка на nvidia-gpu-exporter">​</a></h3>
<p><a href="https://github.com/utkuozdemir/nvidia_gpu_exporter" target="_blank" rel="noopener noreferrer">Nvidia GPU exporter</a> - позволяет получать всю информация о видеокарте</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="настройка-grafana">Настройка Grafana<a href="https://akmalov.com/blog/monitoring-pc-club#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-grafana" class="hash-link" aria-label="Прямая ссылка на Настройка Grafana" title="Прямая ссылка на Настройка Grafana">​</a></h2>
<p>Далее необходимо настроить Grafana (WEB интерфейс доступен по адресу сервера c docker на порту 3000)</p>
<p><code>Configuration -&gt; Data source -&gt; Add Prometheus</code></p>
<p><img decoding="async" loading="lazy" alt="grafana data source" src="https://akmalov.com/assets/images/grafana-data-source-73b1db732b3995f3c7097d0eca430211.png" width="1736" height="866" class="img_ev3q"></p>
<p>Для того чтобы убедиться что все работает корректно, можно скачать и добавить готовые dashboard в графана</p>
<ul>
<li><a href="https://grafana.com/grafana/dashboards/14694-windows-exporter-dashboard/" target="_blank" rel="noopener noreferrer">Windows exporter dashboard</a></li>
<li><a href="https://grafana.com/grafana/dashboards/14574-nvidia-gpu-metrics/" target="_blank" rel="noopener noreferrer">Nvidia GPU dashboard</a></li>
</ul>
<p><code>Dashboard -&gt; Import -&gt; JSON file</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows-exporter-dashboard">Windows exporter dashboard<a href="https://akmalov.com/blog/monitoring-pc-club#windows-exporter-dashboard" class="hash-link" aria-label="Прямая ссылка на Windows exporter dashboard" title="Прямая ссылка на Windows exporter dashboard">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Windows exporter dashboard" src="https://akmalov.com/assets/images/windows-exporter-0897beaf7126eb7b069ea7419b0eefcb.png" width="1919" height="922" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nvidia-gpu-exporter-dashboard">Nvidia GPU exporter dashboard<a href="https://akmalov.com/blog/monitoring-pc-club#nvidia-gpu-exporter-dashboard" class="hash-link" aria-label="Прямая ссылка на Nvidia GPU exporter dashboard" title="Пряма�я ссылка на Nvidia GPU exporter dashboard">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Nvidia GPU exporter dashboard" src="https://akmalov.com/assets/images/nvidia-gpu-exporter-d1f9965ae1cadfc7f593b1a3dd2258bc.png" width="3360" height="1744" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="создание-собственной-панели-мониторинга">Создание собственной панели мониторинга<a href="https://akmalov.com/blog/monitoring-pc-club#%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D0%BE%D0%B9-%D0%BF%D0%B0%D0%BD%D0%B5%D0%BB%D0%B8-%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3%D0%B0" class="hash-link" aria-label="Прямая ссылка на Создание собственной панели мониторинга" title="Прямая ссылка на Создание собственной панели мониторинга">​</a></h2>
<p>Теперь осталась создать свой dashboard и собрать в удобном виде все необходимые метрики</p>
<p>Для себя выбрал следующий тип отображения (в одну линию все необходимые данные)</p>
<p><img decoding="async" loading="lazy" alt="grafana pc dashboard" src="https://akmalov.com/assets/images/grafana-pc-monitoirng-9599a8eb47160e6088bbee8660f05b4c.png" width="1868" height="932" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="итоги">Итоги<a href="https://akmalov.com/blog/monitoring-pc-club#%D0%B8%D1%82%D0%BE%D0%B3%D0%B8" class="hash-link" aria-label="Прямая ссылка на Итоги" title="Прямая ссылка на Итоги">​</a></h2>
<p>Prometheus и Grafana дают возможность настроить удобный монитиринг для компьютерного клуба.
Легко установить, использовать, обслуживать.</p>
<p>Для большого числа компьютеров удобнее использовать Ansible для автоматической установки экспортеров и подготовки конфигурационного файла с помощью шаблонизатора.</p>
<p>Так же экспортеры можно встроить в установку с операционной системой, в таком случаи все новые компьютеры автоматически будут попопадть в систему мониторинга.</p>]]></content>
        <category label="docker" term="docker"/>
        <category label="monitoring" term="monitoring"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Releases info]]></title>
        <id>https://akmalov.com/blog/releases-info</id>
        <link href="https://akmalov.com/blog/releases-info"/>
        <updated>2023-05-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[releases check latest version]]></summary>
        <content type="html"><![CDATA[<p>Решение для проверки последних релизных версий. Готовый docker файл, написан с использованием Python, Flask</p>
<p><a href="https://akmalov.com/blog/releases-info"><img decoding="async" loading="lazy" alt="Releases update info" src="https://akmalov.com/assets/images/update-releases-028b9980ce7a103dfb783076f0b2716c.png" width="1500" height="500" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="releases-info">Releases info<a href="https://akmalov.com/blog/releases-info#releases-info" class="hash-link" aria-label="Прямая ссылка на Releases info" title="Прямая ссылка на Releases info">​</a></h2>
<p>Страница на <a href="https://github.com/akmalovaa/releases-info" target="_blank" rel="noopener noreferrer">Github</a></p>
<p>Сервис проверяет новые версии ваших проектов и показывает, отставание от последних релизов
<img decoding="async" loading="lazy" alt="Releases info" src="https://akmalov.com/assets/images/example-fe614d38594ec87643d3873e58f42f70.png" width="1389" height="612" class="img_ev3q"></p>
<p>На данный момент проверка только с github проектов, где есть релизный список, планируется добавить проверку версий образов с <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker hub</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="запуск">Запуск<a href="https://akmalov.com/blog/releases-info#%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA" class="hash-link" aria-label="Прямая ссылка на Запуск" title="Прямая ссылка на Запуск">​</a></h2>
<p>Скопировать .env.example в .env файл и вставить свой github token (нужен для обращения к github API)</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp .env.example .env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Запустить docker-compose</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="настройка">Настройка<a href="https://akmalov.com/blog/releases-info#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0" class="hash-link" aria-label="Прямая ссылка на Настройка" title="Прямая ссылка на Настройка">​</a></h2>
<p>Необходимо изменить файл config.yml:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">sentry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">github</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> getsentry</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">repo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sentry</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 22.11.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Например ссылка <a href="https://github.com/getsentry/sentry" target="_blank" rel="noopener noreferrer">https://github.com/getsentry/sentry</a></p>
<ul>
<li>owner (владелец) - getsentry</li>
<li>repo (репозиторий) - sentry</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="планы">Планы<a href="https://akmalov.com/blog/releases-info#%D0%BF%D0%BB%D0%B0%D0%BD%D1%8B" class="hash-link" aria-label="Прямая ссылка на Планы" title="Прямая ссылка на Планы">​</a></h2>
<ul>
<li>Добавить проверку обновлений Docker HUB</li>
<li>Уведомления в Telegram о новых релизах</li>
<li>Автоматический парсинг версии с iac</li>
<li>Улучшить интерфейс, попробовать React</li>
<li>Подумать насчет базы данных</li>
</ul>]]></content>
        <category label="docker" term="docker"/>
        <category label="python" term="python"/>
        <category label="flask" term="flask"/>
        <category label="releases" term="releases"/>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Image generator]]></title>
        <id>https://akmalov.com/blog/image-generator-python-flask-docker</id>
        <link href="https://akmalov.com/blog/image-generator-python-flask-docker"/>
        <updated>2022-01-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Image generator Python - Создать изображение необходимого размера веса]]></summary>
        <content type="html"><![CDATA[<p>Image generator Python — простой сервис для создания (генерации) изображений необходимого размера веса</p>
<p><a href="https://akmalov.com/blog/image-generator-python-flask-docker"><img decoding="async" loading="lazy" alt="Releases update info" src="https://akmalov.com/assets/images/image-generator-0a6783032e625551d2c38f1bac28259e.png" width="1500" height="500" class="img_ev3q"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="image-generator">Image generator<a href="https://akmalov.com/blog/image-generator-python-flask-docker#image-generator" class="hash-link" aria-label="Прямая ссылка на Image generator" title="Прямая ссылка на Image generator">​</a></h2>
<p>Для тестирования одного приложения появилось потребность в изображениях разного веса (размера) от 1 до 120 Мб, искал различные генераторы изображений, ничего подходящего не обнаружил (только по разрешению и качеству при изменении которых не угадаешь какой размер получится на выходе — но можно конечно попробовать рассчитать)</p>
<p>Страница <a href="https://github.com/akmalovaa/image-generator" target="_blank" rel="noopener noreferrer">Github</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="принцип-работы">Принцип работы<a href="https://akmalov.com/blog/image-generator-python-flask-docker#%D0%BF%D1%80%D0%B8%D0%BD%D1%86%D0%B8%D0%BF-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B" class="hash-link" aria-label="Прямая ссылка на Принцип работы" title="Прямая ссылка на Принцип работы">​</a></h2>
<ul>
<li>Ввод необходимого размер</li>
<li>Выбор типа изображения (формат, расширение)</li>
<li>Генерация изображения</li>
</ul>
<p>Вроде все просто но на 3 пункте, немного подвис, если создавать изображения с помощью сторонних библиотек где можно задавать только высоту и ширину добиваясь этими параметрами нужных размеров файла было не удобно.</p>
<p>Решил немного схитрить, генерировать файл заполненный случайными данными нужного размера, архивировать его в zip и подсунуть как нагрузку к любому изображению</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="консольный-вариант">Консольный вариант<a href="https://akmalov.com/blog/image-generator-python-flask-docker#%D0%BA%D0%BE%D0%BD%D1%81%D0%BE%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-%D0%B2%D0%B0%D1%80%D0%B8%D0%B0%D0%BD%D1%82" class="hash-link" aria-label="Прямая ссылка на Консольный вариант" title="Прямая ссылка на Консольный вариант">​</a></h2>
<p>В качестве шаблона изображения выбирает случайный файл в директории ./images</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> zipfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> random</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_get_image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">extension</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">"""Get random image from template desire extension (jpg, png)"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    images</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">list</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> dirs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> files </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">walk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">'images/'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> f </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> files</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f'.</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">extension</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                images</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> images</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f'images/</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">random</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token string-interpolation interpolation">choice</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-interpolation interpolation">images</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f'No found template images'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">generate_image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> image_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">str</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'jpg'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">""" Generate binary file and create zip archive """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f"generated/</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">size</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">.</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">image_type</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    size_byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> size</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">str</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'workload.dat'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    generated_zip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">str</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'generated.zip'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">'%s'</span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'wb'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> fout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">urandom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size_byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> zipfile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ZipFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">generated_zip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> mode</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">"w"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> archive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        archive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">""" Merge zip and jpg file """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    jpg_file </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_get_image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">image_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'rb'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    jpg_data </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> jpg_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    jpg_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    zip_file </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">generated_zip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'rb'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    zip_data </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> zip_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    zip_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># merge zip-jpg</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    new_file </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f'generated/</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">size</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">.</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">image_type</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'wb'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    new_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">jpg_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    new_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">zip_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    new_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Remove generated zip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">generated_zip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'__main__'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    input_size </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">input</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">"Enter the desired image size (Mb): "</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        image_size </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">except</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">"Not interesting value, need number(int)"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> image_size </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">and</span><span class="token plain"> image_size </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        generate_image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">image_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">'Sorry, dont want to do this'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="web-версия">Web версия<a href="https://akmalov.com/blog/image-generator-python-flask-docker#web-%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D1%8F" class="hash-link" aria-label="Прямая ссылка на Web версия" title="Прямая ссылка на Web версия">​</a></h2>
<p>Использовал Flask + Bootstrap для оформления.</p>
<p>Ранее не приходилось делать веб скрипты, появилось желание посмотреть и попробовать.</p>
<p>Цели:</p>
<ul>
<li>Поле ввода размера файла в Mb (только цифры от 1 до 999)</li>
<li>Выпадающий список формата файлов</li>
<li>Кнопка</li>
</ul>
<p>Так выглядит без оформления:</p>
<p><img decoding="async" loading="lazy" alt="simple-web" src="data:image/png;base64,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" width="352" height="174" class="img_ev3q"></p>
<p>С использованием стилей Bootstrap:</p>
<p><img decoding="async" loading="lazy" alt="Bootstrap-flask" src="https://akmalov.com/assets/images/bootstrap-346a2aca6995725f4444e58741db1015.png" width="1024" height="533" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="контейнеризация">Контейнеризация<a href="https://akmalov.com/blog/image-generator-python-flask-docker#%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F" class="hash-link" aria-label="Прямая ссылка на Контейнеризация" title="Прямая ссылка на Контейнеризация">​</a></h2>
<p>Ну и чтоб удобнее было использовать собрать все это в docker</p>
<p>Dockerfile:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">FROM python:3.10.5-slim-buster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RUN apt update &amp;&amp; apt upgrade -y &amp;&amp; pip install poetry</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WORKDIR /image-generator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">COPY . .</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RUN poetry config virtualenvs.create false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RUN poetry install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Для удобства запуска docker-compose</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">docker-compose.yml</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">'3.7'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ./</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">generator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token datetime number" style="color:rgb(247, 140, 108)">80:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"python app.py"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./images</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/images</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./generated</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/generated</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="запуск">Запуск<a href="https://akmalov.com/blog/image-generator-python-flask-docker#%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA" class="hash-link" aria-label="Прямая ссылка на Запуск" title="Прямая ссылка на Запуск">​</a></h2>
<p>На сервере или VM с установленным docker, docker-compose</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/akmalovaa/image-generator.git </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker-compose</span><span class="token plain"> up </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-d</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">--build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="заключение">Заключение<a href="https://akmalov.com/blog/image-generator-python-flask-docker#%D0%B7%D0%B0%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5" class="hash-link" aria-label="Прямая ссылка на Заключение" title="Прямая ссылка на Заключение">​</a></h2>
<p>Еще много всего можно доработать, и возможно лучше брать реальный расчет и генерировать нормальные изображения.</p>
<p>Цель достигнута познакомился с Flask скрипт работает, быстро и удобно разворачивается</p>
<p><img decoding="async" loading="lazy" alt="result-files" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAu0AAACfCAMAAAB6FRe2AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACi1BMVEX////l5eWSkpLW1taFhYW7u7utra3//9WNYJGr5//ImXpMYJH/579uYHpMYHpus+qNYHpumdXjs5FMfb/j/////+qrfXqNzdX/zahMmdWNzf9MYKjI//+rzb9ufZGrmZFuYJFuYKirfZGNfZGrs6hus79ufb+r5+qrfajImZGr59WNmdWNYKhMfaiNmZGlpaWjpKSioqKhoaGfn6Cenp6cnZ2bm5uZmprr6+v9/f38/f38/P2mpqafoKD6+/v6+vv5+vr5+fr4+frq6urV1dX4+fmMjIyQkpL4+Pn3+Pn7+/yPkJHbkDoAAAAAAGa2////0aBtbaDR/////+i5h21tbW2g0f+HuejouYfRoG1th7no/////9GgbYe56P//6LmHh7mgh7no/+i5h6CgbW1tbYdtoNGHbW2Nj4+2ZgBmtv9toKCgbaDR0f+HbaC50f+Hh22HbYfRoKAor+o1s+tcv+xCr+r3+PiMjY62ZjqQ2/+5h4egubm50bnRoIcqrupivezy8vJ3tur29/iLjI3//9uQOgA6kNv//7ZmADqQtpA6AACQkGb/25A6kJCHoNG5uaAnqeQZaagjcrJRn+N6quVroOeJiotmAAAAOpDb//86ADoAZrb/tmYAADqgh4eYmJn8/PwXW5oSR4YTRYMlUZlDbMtjhdz7+/uIiYo6OpCg0dGWl5f7/PwTRYQUQ4AVQX0VP3omTZNCa8n29veGiIiVlpb39/gUQX4VP3sWPXcXO3QXOnMmSo/19veFhoc6AGb/0dGTlJX29/eDhYZmZjpth6C56Ojo/9GSk5OChISAgoN/gYKZ0f8AZmZmAGaQtv+QOjpmOpC2tv/o0aD/trZmkJA6ZragoId1JPbFAAAAAWJLR0QAiAUdSAAAAAd0SU1FB+cFFhQWKEgFECgAAAABb3JOVAHPoneaAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA1LTIyVDIwOjIyOjM5KzAwOjAw/hIczQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wNS0yMlQyMDoyMjozOSswMDowMI9PpHEAAABaZVhJZk1NACoAAAAIAAUBEgADAAAAAQABAAABGgAFAAAAAQAAAEoBGwAFAAAAAQAAAFIBKAADAAAAAQACAAACEwADAAAAAQABAAAAAAAAAAAASAAAAAEAAABIAAAAAR9S9zQAAA7iSURBVHja7Z2JfxRnHcbHgoZwJCkFSioqWmu9LS1tTYNpi9JCmi1LYJPdZElQQ2igViseFQseNAdixLsBCfXWgvVsvaUe9WoVrPef43vPO7Oz2cnM++6+7jzfT5jMzvkez/zmnWGf/DwPuMELGl0AR8pj+ryutSugGOmVK5aQyZIrnCmPA+eF2l3ETK8sXeItWepQeRp/XqjdRQz1ytIXmhE71A4sYqpXXuRYeRp9XqjdRVzrFagd2MO1XoHagT1c65VsqL1lWSuZLl/R2qDaZhXVKytXtbU50PqiPMvbKO11P29Lh6FWiKH2lascaO9s4av9ShFxHClPnQsj1U7OuvqqNQbrEQk9zdp1VzvQ3tlC9cr6dqidn9XImWurfX0nmbZ00EtrNQnyy524tTY5qleWX8P6gDR659p1ZBTx4g10lq5h8W5F62q6zO8dMvIhH4U49A9i84TdF1C7OBQdXtiWQkjtrO7RNX7JqjgjrJpqlz8vJVH+ZRtbV758gwvBpsmRvbL2FTKoaeFNLWi5dmMr20b1DotO7ZrA9Q9084TdF1Y7PZSxgFv7vP5Ihp0wosZE/Cs31i5LTbUvb+eN9cpOb/11y6D2uiB7ZeWr1vD7K4uirOHXi4BKu+ZqFu9o+Je9Qx5q2zpF1A18EJsbUjs9VD3V3kHjuax7VI1pOch9MHY9IiF3CN7eLcuuf/WG17yWXmMYydhH9srqdiYwolEZ5cUs65orxSuzdtU7ZK2nJBn4IDdP1n0htbND1Tm2E1TdI2u8dl1qtXeQ60jcCFdf9zoyXbuuHbHdOrKXX7+Btf56fp9mUV7esls6WMD2eN+L3mnpoINXKfDgB7Z5wu4Lqp0fqv5qV3WvrDGZct3HrEckLR2dnhq9d1xD72FXrYHarSN6pYO9325bcf26tjdc2yoiGJvlHUz7o62N9QjvHfZ+vlN7SlUf5ObJui+k9navIWrndY+u8Rvb2mqHduf+1w5QRK/oT6UulMfZ88ZtIqjdRaD2xZ0Xav9/xrVegdqBPVzrFdfV7no9wEK41itQO7CHa70CtQN7uNYrUDuwh2u9ArUDAAAAAAAAAAAAAAAAACA2b7ph0403bb75lls3vbnRRQHAMjd0dXXd1t3dvWXJWyB30ORs6uq5/Y47t27d8ta3bW50WQCwy41dt99B1L5ty1133d3osgBgl5u6qNi3btu+o/cesagvl7t3p5gCq+R39Xu79xQKA/xToTDoFQsEstjzSvQjXyjm+VTuqLZURygODacsUHnviP9hdN8w+dFWvv0d7+wvjxUK+0e88ti43Hz0QKEwNMxWGmqWIq9XiZ5IVk9WMs/ahp15955xWprCeOwDb76Nin3r9h07eu8TiyYO+lNgkd17Dt3f75Xf5Y0+QHuwfH+/EFuRanr03bRL+UI+z6dqR7WlPEJ5LKXaqaL4lcYpyuuQw9VOSkCuqvLe9wxwzY0+SIr03n6Tai+xs5bElc2rx6eq5vTMZIPA1Vmbm7vvPHz48Pve/4EP9j4kFn3oiD8FVimLrmO/8uNSvULK3u4Pj6iFZF5NQzvKmeLD+1KpffeeQaKe/K5qolVqp1fh3qPkZGRm954Bf6WhZjk2wg7oV4bXk03LSu3FcW+xar+le+vhwx/56Mc+frz3Eb5kciqXmxZTwsyJT5wkczMnPskWzJ7MfeoELgRDiK7Ls3sxFTWbyw/6q9VCrcO1HQe9PIvndJPRU6Pp1E4jKA+ZJTo8YFF8/wiL+PuVqJTaR3ho5fclo9ATkoodGivIexVvIK0dyJk/TVcuUu23dm/7zGc/9/kvfPF476Nq4QzTs5jOnT4z+6UjM3Nnvfl7d87MHfT6zkHthuAhWQw8pbBl/Gb3cqV2fl9Xd3fW53RLqnZ2BPIhpdrzdIAyws/BBV1+jAxTyIE1UamRzAj/oecsaleDoYYh95j9oiiigUQzSbWPsUEWG7cPxj7sl7+y/atf+/o3vvmt499+3F86Ma2mTPMTB+kv8m/2/BlxFQADyBDNxCKFPXqKryQDC7WQzYupv6Pckh2BbGkkttOhSZ5Gcxq+L9BIrp4n2JnH2NCeLsmPy9i+yBAbg9IgbYr8uKqenKrYfpQ+L4g7TdyjfueJHd/93vd/8MMfPdnzlL9Ue1Cl2p6cgtqtIAcm7LFMDtGLfCDMQzxfGBy0qx2L/jNk6QKNcoV0j6klMW6nj4M0oB89xUTNQ748M5/l70Qu7OVh34LaB3S1y+fWAX3cnhcXnXxyiMGPn/jJT3/281/88lcXe55WC8nIhU+JsGfmpr3ZX+8UasdIxii0637TL4YNYtjMNE07k/U0X6iNW/0d+ZZEi/wInpc2tqt3MuSYow+OlMdYfA+9+tDU7o0eING2uKvfvNrp6eUTMK+erKSvdjGg4i+F4vHb3uOE3128eLHnGb5kZi6XOyinRN8nfi/m2L/5HJ5SzUG7jr6uHuAjA/bCj7952DvCXqcP8oV8XiyRO/IJVeYB8aYwrdo99Yaz8IfHiNqpzP+4Z2i4mtrZQywt4SKGznEKMcbqQ6rFL3hWPVlJTe1eaehP9I4WO7R7fyZqf/IipefZyA0qxy0k0pusGwD14u4exXORG1SqfeL0mUaXGoAk3HPfQ488+vhTTz/z7HN/idwgqHb6Gh5fKAAAAAAAAKBu/BWAJqKG2ht9uQFgjlhqhwsbNAWx1A4XNmgKYqkdLmzQFMRSO1zYoCmIpfYIFzZ1bXjehPAu8e9DAiukcmH7O4bXJqe2C5t9YXNMuJnMG7D96vn14absvNYcES7sWGqvdGFPTl26vNOb/Ru+x26blC5stWNobZoC1XZhi68ns79vYMGA7beLX5/SgGod1UYVX0WOpfYIF7Y3c5l9E2byeajdMsZc2BV2jyTEcmFLtVsyYAfaRdTnmG9r8dso7MKOpfZKF7ZSO//FvuLOjNhwYBsntQt7XLiwg2sTEsuFrandggE72C7CfctM2bwh/OYIu7BjqT3KhS3UPiH+5sARZcSGb8kw6VzYbEeu9uDahMRyYWsjGTsGbFU9rT40kofUHnZhx1J7lAubqX1yapp/oLGdGbHhSTVOShe22LFibUJiubDlUyoZ71gyYMvq6fUpDVbE9pALO5bao1zYVO1q0C7UPjkFtZsnpQtb7Ghk0M6OFsOFLWO7J4RuTe2B+nBTdnDcHnRhx1J7lAubqn3+LJs7oRuxMZIxTSoXNt+RaLFibVLiuLB18VsxYMvq6fUhpeENIdoowoUdS+2VLmyu9r4cYVqonRux4cA2TioXNt+RiK9ibYoC1XJh00vA/2jcgK21i6qPMGXntWmECzuW2mu7sC/v1IYvcGADN4ml9pou7PnTZzS1w4EN3CSW2mu4sGdPnjsiH03hwAbuAjcHyA5QO8gOUDvIDrXUDkAT0ejLDQC3gAsbZAe4sEF2gAsbZAe4sEF2iHJhT+TOiUw0jS5dswMX9kIEcmGHEmSby4U9baHkoBK4sBckmAs7nCDbUC7smb/ji1/1Ai7sBdomlAs7mCDbVC7s+UtzOfZNR/ivrQMXdnVCubBDCbJN5cKeJ4N2mRcY/mu7wIW9QGlCubCDCbJN5cKmHj3m04P/2jpwYVenMhe2niDbVC7ssNrhv7YHXNjVicyFrandTC5sImue6R3+a+vAhb1A2wRzYXvBBNmmcmHTR9KzHvzX9QAu7AUI5sIOJcg2ngsb/mvQZCzgwob/GjQZVV3Y8F8DAAAAAAAAAAAAWAMubJAd4MIG2QEubJAd4MIG2aHShU3/4/QgnYEL2zqGXNg8d3S+uVzYqnpqhlphq+bCjkWlC3vmH/gGWH0w5cIWH4Omi2QFcsiF7beLmCmPkQurai7sWETlwpYJU4FtTLmwZVauYqrg7pYLW28Ibkx8eN9w9VzYsYjKha0n1IML2yamXNgsK9dgWkeHWy5sT6sONzCSYVX1XNixiMiF3ZdjYocL2z6mXNhm1O6WC1u1C58hpQio3ZAL2+N/dgAu7DpgyIVtNLa74sLWqkdnSPWCsd2MC5syQV/KwIVtHTMubFPjdrdc2Fr1yMwFGsQLQ/+smgs7FpUu7H/tVKZUuLAtY8aFLWyqDxh7J+OEC1uZr30X9r7h6rmwY1HpwiZPpLmDcGHXBTMubLFPfjF+5GoFcseFzasXmNk3XD0XdizgwgbZAS5skB3gwgYAAAAAAAAAAACoP3Bhg+wAFzbIDnBhg+wAFzbIDlG5sL0+9i0BuLCtk9iFzWyhoW1M4JALO1xJS7mwPepYslF4ECSxC5s7ktU2Br7rKwvkkAs7VElLubBJaP/3eai9LiR2YVNHstqmOJjax8EP5ZgLO1BJS7mwvdn/zJ5HLuy6kNSFzRzJKgu2KbU75sJmlVQNYSkX9uTzR3y1w4VtlYQubO5IVlmwSTROnRmY4pYLm1dSNYRnJxd237SnxXa4sG2S0IXNHclqGyq5/xqL7a64sMOV9Kzkwp7LEehjKlzY1knmwi5zR/Jw4DaQ2qTnueXCjq6k8VzYBKJuuLDrQWIXtsdHMv6fFxoaXvTJK3HKhc0rqVfbSi5sXe1wYVslsQtbqJ0vIWFwl6HnRYdc2J5Uu6okcmEDEB+4sEF2gAsbAAAAAAAAAAAAoP7AhQ2yA1zYIDvAhQ2yA1zYIDtEubDn+f+bwoVtnYQubH8Xbk0uNacLW3kGA6m+i8K7ZMaFPTl1CcmB60JiF7bahX+tXXNnpy2QQy5s3jp+M4mv1QtrtjkXNlJh14vELmy5zbERtWX60rjmwg6kwqZ3GXptC2u2uVzYQu1wYVsncS5skQWbW5P15WlwzIUdVDs1U1HRC2u2sVzYutrhwrZK0lzYfhZs0d8lE+N2t1zYIbXTZ4QB35ptLhe2HtvhwrZJ4lzYfppoKk4jf3HANRd25EhGWbPN5cIOqh0ubHskzoWtp4keMDJoZ4dyyIXthdTOLvtDypptzoVN1Q4Xdj1I6MLWsmDT9yL5+K/gFsYxF3ZA7bS2bIwlY7spF7amdriwrZLQha2yYHNrsu7OTlsgl1zYwXF7UbxY99UOFzYA1YELG2QHuLABAAAAAAAAAAAArPI/+O8YIPbGA/UAAAAASUVORK5CYII=" width="749" height="159" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="file-info" src="https://akmalov.com/assets/images/file-info-2d9a51252576a9c36e923af57c503aa6.png" width="416" height="547" class="img_ev3q"></p>
<p>Файлы открываются в Windows, Photoshop и WinRAR</p>
<p>Если изменить изображение в редакторе и сохранить нагрузочный архив исчезнет и картинка станет оригинального размера.</p>]]></content>
        <category label="docker" term="docker"/>
        <category label="python" term="python"/>
        <category label="flask" term="flask"/>
        <category label="image" term="image"/>
    </entry>
</feed>