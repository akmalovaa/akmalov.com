"use strict";(self.webpackChunkakmalov_com=self.webpackChunkakmalov_com||[]).push([[3915],{5176:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>m,frontMatter:()=>c,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"proxmox/vm-template","title":"VM template","description":"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u043e\u0431\u0440\u0430\u0437 Ubuntu Cloud Init \u0438 \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0435\u0433\u043e \u043d\u0430 \u0441\u0432\u043e\u0439 \u0441\u0435\u0440\u0432\u0435\u0440","source":"@site/docs/proxmox/vm-template.md","sourceDirName":"proxmox","slug":"/proxmox/vm-template","permalink":"/docs/proxmox/vm-template","draft":false,"unlisted":false,"editUrl":"https://github.com/akmalovaa/akmalov.com/tree/main/docs/proxmox/vm-template.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"VM template"},"sidebar":"tutorialSidebar","previous":{"title":"Proxmox commands","permalink":"/docs/proxmox/commands"},"next":{"title":"Host CPU check","permalink":"/docs/proxmox/host_cpu"}}');var i=s(4848),l=s(8453);const c={sidebar_position:3,title:"VM template"},r="VM Template Ubuntu Cloud Init",o={},a=[];function d(e){const n={a:"a",code:"code",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"vm-template-ubuntu-cloud-init",children:"VM Template Ubuntu Cloud Init"})}),"\n",(0,i.jsx)(n.p,{children:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u043e\u0431\u0440\u0430\u0437 Ubuntu Cloud Init \u0438 \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0435\u0433\u043e \u043d\u0430 \u0441\u0432\u043e\u0439 \u0441\u0435\u0440\u0432\u0435\u0440"}),"\n",(0,i.jsxs)(n.p,{children:["\u0421\u0430\u0439\u0442: ",(0,i.jsx)(n.a,{href:"https://cloud-images.ubuntu.com/",children:(0,i.jsx)("u",{children:"Ubuntu Cloud Images"})})]}),"\n",(0,i.jsx)(n.p,{children:"\u0414\u0430\u043b\u044c\u043d\u0438\u0435\u0439\u0448\u0438\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u0441\u0435\u0440\u0432\u0435\u0440\u0435 Proxmox"}),"\n",(0,i.jsx)(n.p,{children:"\u0421\u043a\u0430\u0447\u0430\u0442\u044c \u043e\u0431\u0440\u0430\u0437:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd /tmp\nwget https://cloud-images.ubuntu.com/noble/current/noble-server-cloudimg-amd64.img\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0431\u0430\u0437\u043e\u0432\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0434\u0438\u0441\u043a\u0430"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"qemu-img resize noble-server-cloudimg-amd64.img 15G\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c VM \u0441 \u043d\u0443\u0436\u043d\u044b\u043c\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c\u0438:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'qm create 2000 --name "ubuntu-template" --ostype l26 --memory 4096 --agent 1 --bios ovmf --machine q35 --efidisk0 local-lvm:0,pre-enrolled-keys=0 --cpu x86-64-v2-AES --cores 2 --vga serial0 --serial0 socket --net0 virtio,bridge=vmbr0\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--cpu x86-64-v2-AES"})," - \u0436\u0435\u043b\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u043b\u0438 ",(0,i.jsx)(n.code,{children:"x86-64-v4"})," (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e kvm64 - \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u044c)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--ostype l26"})," - \u0442\u0438\u043f \u041e\u0421 Linux 2.6/3.x/4.x/5.x"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--agent"})," - \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c QEMU Guest Agent"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--machine q35"})," - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u043c\u043e\u0434\u0435\u043b\u044c \u043c\u0430\u0448\u0438\u043d\u044b Q35"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--bios ovmf"})," - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c UEFI BIOS"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--efidisk0"})," - \u0441\u043e\u0437\u0434\u0430\u0442\u044c EFI \u0434\u0438\u0441\u043a \u0434\u043b\u044f UEFI \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--vga serial0 --serial0 socket"})," - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u043e\u043d\u0441\u043e\u043b\u044c \u0447\u0435\u0440\u0435\u0437 serial (\u043f\u043e\u043b\u0435\u0437\u043d\u043e \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0431\u0435\u0437 GUI)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u0418\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0441\u043a \u0441 \u041e\u0421 \u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c Cloud Init \u0434\u0438\u0441\u043a:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"qm importdisk 2000 /tmp/noble-server-cloudimg-amd64.img local-lvm\nqm set 2000 --scsihw virtio-scsi-pci --virtio0 local-lvm:vm-2000-disk-1,discard=on\nqm set 2000 --boot order=virtio0\nqm set 2000 --scsi1 local-lvm:cloudinit\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0430\u0439\u043b \u0441 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u043c\u0438 \u0441\u0435\u0442\u0438 \u0434\u043b\u044f Cloud Init, \u0433\u0434\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043d\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0443 QEMU Guest Agent"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"nano /var/lib/vz/snippets/ubuntu.yaml\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0444\u0430\u0439\u043b\u0430:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-config",children:"#cloud-config\ntimezone: Asia/Yekaterinburg\npackage_upgrade: true\npackage_reboot_if_required: true\npackages:\n  - qemu-guest-agent\n  - net-tools\n  - curl\nruncmd:\n  - systemctl start qemu-guest-agent\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u041d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c Cloud Init \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0434\u043b\u044f VM:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'qm set 2000 --cicustom "vendor=local:snippets/ubuntu.yaml"\nqm set 2000 --ciuser root --cipassword \'12345\'\nqm set 2000 --tags ubuntu\nqm set 2000 --sshkeys ~/.ssh/ansible.pub\nqm set 2000 --ipconfig0 ip=dhcp\nqm set 2000 --nameserver "8.8.8.8 1.1.1.1"\nqm set 2000 --searchdomain "local"\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u041f\u0440\u0435\u0432\u0440\u0430\u0442\u0438\u0442\u044c VM \u0432 \u0448\u0430\u0431\u043b\u043e\u043d:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"qm template 2000\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u0422\u0435\u043f\u0435\u0440\u044c \u043c\u043e\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0435 VM \u0438\u0437 \u044d\u0442\u043e\u0433\u043e \u0448\u0430\u0431\u043b\u043e\u043d\u0430"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'qm clone 2000 2001 --name ubuntu-vm1 --full --description "host1"\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u0415\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u043c\u0435\u043d\u044f\u0442\u044c \u043d\u0430 \u0441\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 IP \u0438 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u0437\u0430\u043f\u0443\u0441\u043a:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"qm set 2001 --ipconfig0 ip=10.100.0.201/24,gw=10.100.0.1\nqm set 2001 --onboot 1\n"})})]})}function m(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>r});var t=s(6540);const i={},l=t.createContext(i);function c(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);